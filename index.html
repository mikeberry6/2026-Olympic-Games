<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Milan 2026 Olympic Fantasy Market - Build your medal portfolio">
  <meta name="theme-color" content="#0a0e1a">
  <title>Milan 2026 Fantasy Market</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Snowfall Animation Container -->
  <div class="snowfall" id="snowfall"></div>

  <!-- ============================================ -->
  <!-- VIEW A: WELCOME / INSTRUCTIONS               -->
  <!-- ============================================ -->
  <section id="welcome-view" class="view">
    <div class="container">
      <header class="welcome-header">
        <div class="olympic-rings">‚óè‚óè‚óè‚óè‚óè</div>
        <h1 class="logo"><span class="city">Milano Cortina</span><span class="year">2026</span></h1>
        <p class="welcome-subtitle">üèîÔ∏è Fantasy Medal Market üèîÔ∏è</p>
      </header>

      <div class="commissioner-card glass-card">
        <div class="commissioner-badge">üìã COMMISSIONER REIF-WRAY'S BRIEFING</div>
        <div class="commissioner-content">
          <p class="commissioner-date">üìÖ Today is <strong>Thursday, February 5, 2026</strong></p>
          <p class="commissioner-intro">Benvenuti, competitors! The Opening Ceremony at the San Siro is just <strong>24 hours away</strong>. I am Commissioner Reif-Wray, your host for the Milan-Cortina 2026 Fantasy Market.</p>

          <div class="rules-box">
            <h3>üí∞ The Rules</h3>
            <ul>
              <li>You have a strict <strong>$100 budget</strong></li>
              <li>Buy countries at prices pegged to projected medal counts</li>
              <li>Your goal: <strong>Maximize your total medal return</strong></li>
              <li>If you buy Norway for $40, you're betting they win 40+ medals</li>
              <li>Scoring: ü•á Gold = 3pts | ü•à Silver = 2pts | ü•â Bronze = 1pt</li>
            </ul>
          </div>

          <div class="market-preview">
            <h3>üìä MARKET TIERS</h3>
            <div class="tier-preview">
              <span class="tier-badge blue-chip">üíé BLUE CHIPS</span>
              <span class="tier-desc">$26-40 | Safe, high volume</span>
            </div>
            <div class="tier-preview">
              <span class="tier-badge mid-cap">üìà MID-CAPS</span>
              <span class="tier-desc">$9-20 | Value plays & host bumps</span>
            </div>
            <div class="tier-preview">
              <span class="tier-badge penny-stock">üé∞ PENNY STOCKS</span>
              <span class="tier-desc">$1-7 | High risk, specific events</span>
            </div>
          </div>
        </div>
      </div>

      <div class="sample-portfolios glass-card">
        <h3>üìù Sample Portfolios</h3>

        <div class="portfolio-example">
          <h4>ü¶Ö "Norwegian Empire" ($99)</h4>
          <p>Norway ($40) + Austria ($20) + Netherlands ($15) + Japan ($14) + South Korea ($10)</p>
        </div>

        <div class="portfolio-example">
          <h4>üèîÔ∏è "North American Power" ($100)</h4>
          <p>USA ($32) + Canada ($26) + Switzerland ($17) + Japan ($14) + Czech Republic ($7) + Australia ($4)</p>
        </div>

        <div class="portfolio-example">
          <h4>üé≤ "Mid-Cap Spread" ($100)</h4>
          <p>Italy ($18) + Sweden ($19) + France ($16) + Netherlands ($15) + South Korea ($10) + China ($9) + Finland ($9) + Australia ($4)</p>
        </div>
      </div>

      <div class="countdown-card glass-card" id="countdown-card">
        <div class="countdown-label">Opening Ceremony Countdown</div>
        <div class="countdown-timer" id="countdown-timer"></div>
      </div>

      <button id="enter-market-btn" class="btn btn-primary btn-large">
        üéø Andiamo! Enter the Market
      </button>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- VIEW A2: VIDEO INTERSTITIAL                  -->
  <!-- ============================================ -->
  <section id="video-view" class="view hidden">
    <div class="container video-container">
      <header class="video-header">
        <div class="olympic-rings">‚óè‚óè‚óè‚óè‚óè</div>
        <h2 class="video-title">üáÆüáπ Milano Cortina 2026 üáÆüáπ</h2>
        <p class="video-subtitle">The Winter Games Await</p>
      </header>

      <div class="video-wrapper glass-card">
        <div class="video-responsive">
          <iframe
            id="intro-video"
            src=""
            title="Milano Cortina 2026 Preview"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
        </div>
      </div>

      <div class="video-actions">
        <button id="continue-to-draft-btn" class="btn btn-primary btn-large">
          üèîÔ∏è Continue to Draft üèîÔ∏è
        </button>
        <button id="skip-video-btn" class="btn btn-secondary">
          Skip Video
        </button>
      </div>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- VIEW B: PARTICIPANT SELECTION                -->
  <!-- ============================================ -->
  <section id="participant-view" class="view hidden">
    <div class="container">
      <header class="view-header">
        <div class="olympic-rings small">‚óè‚óè‚óè‚óè‚óè</div>
        <h1 class="logo small"><span class="city">Milano Cortina</span><span class="year">2026</span></h1>
      </header>

      <h2 class="view-title">üë• Select Your Team</h2>
      <p class="view-desc">Who's building their portfolio?</p>

      <div id="participant-list" class="participant-list">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- VIEW C: THE MARKET                           -->
  <!-- ============================================ -->
  <section id="market-view" class="view hidden">
    <div class="container">
      <header class="market-header">
        <div class="header-left">
          <button id="back-to-participants-btn" class="btn-back" aria-label="Back to participant selection">&larr; Back</button>
          <div class="olympic-rings small">‚óè‚óè‚óè‚óè‚óè</div>
          <div class="current-buyer" id="current-buyer">Building for: ---</div>
        </div>
        <div class="budget-display">
          <div class="budget-label">Budget Remaining</div>
          <div class="budget-amount" id="budget-amount">$100</div>
          <div class="budget-bar">
            <div class="budget-fill" id="budget-fill" style="width: 100%"></div>
          </div>
        </div>
      </header>

      <div class="cart-summary glass-card" id="cart-summary">
        <h3>üõí Your Portfolio</h3>
        <div class="cart-items" id="cart-items">
          <p class="empty-cart">No countries selected yet</p>
        </div>
        <div class="cart-total">
          <span>Total Spent:</span>
          <span id="cart-total-amount">$0</span>
        </div>
      </div>

      <!-- Blue Chips -->
      <section class="market-tier">
        <h2 class="tier-title">üíé BLUE CHIPS <span class="tier-subtitle">High floor, reliable volume (26+ medals projected)</span></h2>
        <div class="country-grid" id="blue-chip-grid">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- Mid Caps -->
      <section class="market-tier">
        <h2 class="tier-title">üìà MID-CAPS <span class="tier-subtitle">Value plays & host bumps (9-20 medals projected)</span></h2>
        <div class="country-grid" id="mid-cap-grid">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- Penny Stocks -->
      <section class="market-tier">
        <h2 class="tier-title">üé∞ PENNY STOCKS <span class="tier-subtitle">High risk, specific events (1-7 medals projected)</span></h2>
        <div class="country-grid" id="penny-stock-grid">
          <!-- Populated by JS -->
        </div>
      </section>

      <div class="market-actions">
        <button id="confirm-portfolio-btn" class="btn btn-primary btn-large" disabled>
          ‚úÖ Confirm Portfolio
        </button>
        <button id="clear-cart-btn" class="btn btn-secondary">
          üóëÔ∏è Clear Selection
        </button>
      </div>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- VIEW D: DASHBOARD                            -->
  <!-- ============================================ -->
  <section id="dashboard-view" class="view hidden">
    <div class="container">
      <header class="dashboard-header">
        <div class="header-top">
          <div class="header-brand">
            <div class="olympic-rings small">‚óè‚óè‚óè‚óè‚óè</div>
            <h1 class="logo"><span class="city">Milano Cortina</span><span class="year">2026</span></h1>
          </div>
          <div class="total-medals">
            <div class="medal-trophy">üèÜ</div>
            <span class="medal-count" id="total-medal-count">0</span>
            <span class="medal-label">Total Points</span>
          </div>
        </div>
      </header>

      <!-- Leaderboard Section -->
      <section class="leaderboard-section">
        <div class="section-title-row">
          <h2 class="section-title">üèÖ Leaderboard</h2>
          <button id="refresh-dashboard-btn" class="btn-refresh" aria-label="Refresh dashboard">‚Üª Refresh</button>
        </div>
        <div id="leaderboard-cards" class="leaderboard-cards">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- Portfolio Details Section -->
      <section class="portfolios-section">
        <h2 class="section-title">üìä Team Portfolios</h2>
        <div id="portfolio-grid" class="portfolio-grid">
          <!-- Populated by JS -->
        </div>
      </section>
    </div>

    <!-- Footer with Admin Access -->
    <footer class="app-footer">
      <div class="footer-info">
        <span class="version">v5.0 Milano Edition</span>
        <span class="last-updated" id="last-updated"></span>
      </div>
      <button id="admin-key-btn" class="admin-key-btn" aria-label="Admin access">
        üîë
      </button>
    </footer>
  </section>

  <!-- ============================================ -->
  <!-- VIEW E: ADMIN CONSOLE (Modal)               -->
  <!-- ============================================ -->
  <div id="admin-modal" class="modal hidden" role="dialog" aria-labelledby="admin-title" aria-modal="true">
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="modal-content">
      <header class="modal-header">
        <h2 id="admin-title" class="modal-title">üîê Commissioner Reif-Wray's Console</h2>
        <button id="close-modal-btn" class="close-btn" aria-label="Close">&times;</button>
      </header>

      <div class="modal-body">
        <!-- Add Medal Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">üèÖ Record Medal</h3>

          <div class="form-group">
            <label for="country-select">Select Country</label>
            <select id="country-select" class="form-select">
              <option value="">-- Select country --</option>
              <!-- Populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="event-input">Event Description</label>
            <input type="text" id="event-input" class="form-input" placeholder="e.g., Men's Downhill Alpine Skiing" list="event-suggestions" autocomplete="off">
            <datalist id="event-suggestions"></datalist>
          </div>

          <div class="form-group">
            <label>Medal Type</label>
            <div class="medal-buttons">
              <button type="button" class="medal-btn gold" data-medal="gold">ü•á Gold (+3)</button>
              <button type="button" class="medal-btn silver" data-medal="silver">ü•à Silver (+2)</button>
              <button type="button" class="medal-btn bronze" data-medal="bronze">ü•â Bronze (+1)</button>
            </div>
          </div>

          <button id="add-medal-btn" class="btn btn-primary" disabled>Record Medal</button>
        </section>

        <!-- Transaction Log Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">üìú Medal Log</h3>
          <div id="transaction-log" class="transaction-log">
            <p class="empty-state">No medals recorded yet</p>
          </div>
        </section>

        <!-- Data Management Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">‚öôÔ∏è League Management</h3>
          <div class="data-actions">
            <button id="export-btn" class="btn btn-secondary">üìã Export</button>
            <button id="import-btn" class="btn btn-secondary">üì• Import</button>
          </div>
          <button id="reopen-market-btn" class="btn btn-warning">üè™ Reopen Market</button>
          <button id="reset-btn" class="btn btn-danger">üóëÔ∏è Reset League</button>
        </section>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast hidden" role="alert" aria-live="polite"></div>

  <!-- ============================================ -->
  <!-- STYLES                                       -->
  <!-- ============================================ -->
  <style>
    /* ========================================
       1. CSS VARIABLES - Milano Cortina 2026 Theme
       ======================================== */
    :root {
      /* Milano Cortina 2026 Inspired Colors */
      --bg-depth: #0a0e1a;
      --bg-surface: #141c2f;
      --bg-elevated: #1a2440;
      --glass-border: 1px solid rgba(255, 255, 255, 0.1);
      --glass-bg: rgba(20, 28, 47, 0.8);

      /* Italian Flag + Olympic Colors */
      --italian-green: #008C45;
      --italian-red: #CD212A;
      --olympic-blue: #0081C8;
      --olympic-yellow: #FCB131;
      --olympic-green: #00A651;
      --olympic-red: #EE334E;

      /* Tier Colors */
      --blue-chip: #4FC3F7;
      --mid-cap: #81C784;
      --penny-stock: #FFB74D;

      /* Primary Accent */
      --accent-primary: #00D4FF;
      --accent-gold: #FFD700;

      --text-primary: #FFFFFF;
      --text-secondary: #B8C5D6;
      --text-muted: #7A8BA3;

      /* Medal Colors */
      --gold: #FFD700;
      --silver: #C0C0C0;
      --bronze: #CD7F32;

      /* Semantic */
      --success: #00E676;
      --warning: #FFAB00;
      --danger: #FF5252;

      /* Typography */
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;

      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ========================================
       2. RESET & BASE
       ======================================== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-depth);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* Animated Background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(0, 140, 69, 0.12) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(0, 129, 200, 0.12) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(205, 33, 42, 0.08) 0%, transparent 50%);
      animation: gradientShift 25s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Snowfall */
    .snowfall {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .snowflake {
      position: absolute;
      top: -20px;
      color: rgba(255, 255, 255, 0.5);
      animation: fall linear infinite;
    }

    @keyframes fall {
      to { transform: translateY(105vh) rotate(360deg); }
    }

    /* ========================================
       3. LAYOUT
       ======================================== */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-md);
      position: relative;
      z-index: 2;
    }

    .view {
      min-height: 100vh;
      padding-bottom: 100px;
    }

    .hidden { display: none !important; }

    /* ========================================
       4. TYPOGRAPHY
       ======================================== */
    .logo {
      font-size: 1.75rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      text-transform: uppercase;
    }

    .logo.small { font-size: 1.25rem; }

    .logo .city {
      background: linear-gradient(135deg, var(--italian-green), var(--olympic-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo .year {
      background: linear-gradient(135deg, var(--olympic-yellow), var(--italian-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-left: 0.25em;
    }

    .olympic-rings {
      font-size: 1.25rem;
      letter-spacing: 0.15em;
      background: linear-gradient(90deg, #0081C8, #000, #EE334E, #FCB131, #00A651);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--space-xs);
    }

    .olympic-rings.small { font-size: 0.75rem; }

    .section-title {
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-primary);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 1em;
      background: linear-gradient(180deg, var(--italian-green), var(--italian-red));
      border-radius: 2px;
    }

    /* ========================================
       5. GLASS CARD
       ======================================== */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
    }

    /* ========================================
       6. BUTTONS
       ======================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      font-family: inherit;
      font-size: 0.9375rem;
      font-weight: 600;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-normal);
      min-height: 48px;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--italian-green), var(--olympic-blue));
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 140, 69, 0.4);
      background: linear-gradient(135deg, var(--italian-green), var(--italian-red));
    }

    .btn-secondary {
      background: var(--bg-surface);
      color: var(--text-primary);
      border: var(--glass-border);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-elevated);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), var(--olympic-yellow));
      color: #000;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), var(--italian-red));
      color: #fff;
    }

    .btn-large {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      font-size: 1.0625rem;
      min-height: 56px;
      border-radius: var(--radius-lg);
    }

    /* ========================================
       7. FORMS
       ======================================== */
    .form-group {
      margin-bottom: var(--space-md);
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: var(--space-xs);
    }

    .form-select, .form-input {
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      font-family: inherit;
      font-size: 1rem;
      color: var(--text-primary);
      background: var(--bg-surface);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      min-height: 48px;
    }

    .form-select:focus, .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    /* ========================================
       8. VIEW A - WELCOME
       ======================================== */
    .welcome-header {
      text-align: center;
      padding: var(--space-2xl) 0 var(--space-xl);
    }

    .welcome-subtitle {
      font-size: 1.5rem;
      color: var(--text-secondary);
      margin-top: var(--space-sm);
    }

    .commissioner-card {
      margin-bottom: var(--space-lg);
      border: none;
      position: relative;
      overflow: hidden;
    }

    .commissioner-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--italian-green), white, var(--italian-red));
    }

    .commissioner-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--accent-gold), #FFA500);
      color: #000;
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-sm);
      font-weight: 700;
      font-size: 0.875rem;
      margin-bottom: var(--space-md);
      letter-spacing: 0.02em;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .commissioner-date {
      color: var(--accent-primary);
      margin-bottom: var(--space-sm);
    }

    .commissioner-intro {
      font-size: 1.0625rem;
      line-height: 1.6;
      margin-bottom: var(--space-lg);
    }

    .rules-box {
      background: rgba(0, 212, 255, 0.08);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      margin-bottom: var(--space-lg);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-top: 3px solid var(--accent-primary);
    }

    .rules-box h3 {
      color: var(--accent-primary);
      margin-bottom: var(--space-sm);
      font-size: 1rem;
    }

    .rules-box ul {
      list-style: none;
      padding-left: 0;
    }

    .rules-box li {
      padding: var(--space-xs) 0;
      padding-left: var(--space-lg);
      position: relative;
      color: var(--text-secondary);
    }

    .rules-box li::before {
      content: '‚ñ∏';
      position: absolute;
      left: 0;
      color: var(--accent-primary);
    }

    .market-preview h3 {
      margin-bottom: var(--space-md);
      font-size: 1rem;
    }

    .tier-preview {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-sm) 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .tier-preview:last-child { border-bottom: none; }

    .tier-badge {
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 700;
      min-width: 120px;
      text-align: center;
    }

    .tier-badge.blue-chip { background: rgba(79, 195, 247, 0.2); color: var(--blue-chip); }
    .tier-badge.mid-cap { background: rgba(129, 199, 132, 0.2); color: var(--mid-cap); }
    .tier-badge.penny-stock { background: rgba(255, 183, 77, 0.2); color: var(--penny-stock); }

    .tier-desc {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .sample-portfolios {
      margin-bottom: var(--space-xl);
    }

    .sample-portfolios::before {
      content: '';
      display: block;
      height: 3px;
      margin: calc(var(--space-lg) * -1);
      margin-bottom: var(--space-lg);
      background: linear-gradient(90deg, var(--italian-green), white, var(--italian-red));
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .sample-portfolios h3 {
      margin-bottom: var(--space-md);
    }

    .portfolio-example {
      background: var(--bg-surface);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      margin-bottom: var(--space-sm);
    }

    .portfolio-example:last-child { margin-bottom: 0; }

    .portfolio-example h4 {
      font-size: 0.9375rem;
      margin-bottom: var(--space-xs);
      color: var(--text-primary);
    }

    .portfolio-example p {
      font-size: 0.8125rem;
      color: var(--text-muted);
    }

    /* ========================================
       8B. VIDEO INTERSTITIAL
       ======================================== */
    .video-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: var(--space-lg);
    }

    .video-header {
      text-align: center;
      margin-bottom: var(--space-lg);
    }

    .video-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: var(--space-xs);
      background: linear-gradient(135deg, var(--italian-green), var(--accent-gold), var(--italian-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .video-subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .video-wrapper {
      width: 100%;
      max-width: 800px;
      padding: var(--space-sm);
      margin-bottom: var(--space-lg);
    }

    .video-responsive {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 */
      height: 0;
      overflow: hidden;
      border-radius: var(--radius-md);
    }

    .video-responsive iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: var(--radius-md);
    }

    .video-actions {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      width: 100%;
      max-width: 400px;
    }

    #skip-video-btn {
      font-size: 0.875rem;
      min-height: 40px;
      opacity: 0.7;
    }

    /* ========================================
       9. VIEW B - PARTICIPANT SELECTION
       ======================================== */
    .view-header {
      text-align: center;
      padding: var(--space-lg) 0;
    }

    .view-title {
      font-size: 1.5rem;
      margin-bottom: var(--space-xs);
    }

    .view-desc {
      color: var(--text-muted);
      margin-bottom: var(--space-lg);
    }

    .participant-list {
      display: grid;
      gap: var(--space-md);
    }

    .participant-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .participant-card:hover {
      transform: translateY(-2px);
      border-color: var(--accent-primary);
      box-shadow: 0 8px 30px rgba(0, 212, 255, 0.15);
    }

    .participant-card.completed {
      border-color: var(--success);
      opacity: 0.7;
    }

    .participant-card.completed::after {
      content: '‚úì Portfolio Set';
      font-size: 0.75rem;
      color: var(--success);
    }

    .participant-name {
      font-weight: 600;
      font-size: 1.0625rem;
    }

    /* ========================================
       10. VIEW C - MARKET
       ======================================== */
    .market-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: var(--space-md);
      padding: var(--space-lg) 0;
      position: sticky;
      top: 0;
      background: var(--bg-depth);
      z-index: 10;
      margin: 0 calc(var(--space-md) * -1);
      padding-left: var(--space-md);
      padding-right: var(--space-md);
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .current-buyer {
      font-size: 0.875rem;
      color: var(--accent-primary);
      font-weight: 600;
    }

    .budget-display {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      min-width: 160px;
      text-align: center;
    }

    .budget-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .budget-amount {
      font-size: 2rem;
      font-weight: 800;
      color: var(--success);
      font-feature-settings: "tnum";
    }

    .budget-amount.warning { color: var(--warning); }
    .budget-amount.danger { color: var(--danger); }

    .budget-bar {
      height: 4px;
      background: var(--bg-surface);
      border-radius: 2px;
      margin-top: var(--space-xs);
      overflow: hidden;
    }

    .budget-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), var(--accent-primary));
      transition: width var(--transition-normal);
    }

    .cart-summary {
      margin-bottom: var(--space-lg);
    }

    .cart-summary h3 {
      margin-bottom: var(--space-sm);
      font-size: 1rem;
    }

    .cart-items {
      min-height: 40px;
      margin-bottom: var(--space-sm);
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-xs) 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .cart-item:last-child { border-bottom: none; }

    .cart-item-info {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .cart-item-remove {
      background: none;
      border: none;
      color: var(--danger);
      cursor: pointer;
      padding: var(--space-xs);
      font-size: 0.875rem;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      padding-top: var(--space-sm);
      border-top: var(--glass-border);
    }

    .empty-cart {
      color: var(--text-muted);
      font-style: italic;
      font-size: 0.875rem;
    }

    /* Market Tiers */
    .market-tier {
      margin-bottom: var(--space-xl);
    }

    .tier-title {
      font-size: 1.125rem;
      margin-bottom: var(--space-md);
      display: flex;
      align-items: baseline;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .tier-subtitle {
      font-size: 0.8125rem;
      font-weight: 400;
      color: var(--text-muted);
    }

    .country-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-md);
    }

    .country-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
    }

    .country-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }

    .country-card.selected {
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
    }

    .country-card.disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .country-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-sm);
    }

    .country-flag {
      font-size: 2rem;
    }

    .country-price {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-gold);
    }

    .country-name {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: var(--space-xs);
    }

    .country-projection {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
    }

    .country-desc {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .country-selected-badge {
      position: absolute;
      top: var(--space-sm);
      right: var(--space-sm);
      background: var(--accent-primary);
      color: #000;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 0.6875rem;
      font-weight: 700;
    }

    .market-actions {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      padding: var(--space-lg) 0;
    }

    /* ========================================
       11. VIEW D - DASHBOARD
       ======================================== */
    .dashboard-header {
      padding: var(--space-xl) 0 var(--space-lg);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--space-md);
    }

    .header-brand {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .total-medals {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 215, 0, 0.2);
    }

    .medal-trophy {
      font-size: 1.5rem;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .total-medals .medal-count {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent-gold);
      font-feature-settings: "tnum";
    }

    .total-medals .medal-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    /* Leaderboard */
    .leaderboard-section {
      margin-bottom: var(--space-xl);
    }

    .leaderboard-cards {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .leaderboard-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .leaderboard-card::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--italian-green), white, var(--italian-red));
      opacity: 0.5;
    }

    .leaderboard-card.rank-1 {
      border-color: rgba(255, 215, 0, 0.4);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.12), var(--glass-bg));
      animation: goldGlow 3s ease-in-out infinite;
    }

    @keyframes goldGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.15); }
      50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.25); }
    }

    .leaderboard-card.rank-2 {
      border-color: rgba(192, 192, 192, 0.3);
      background: linear-gradient(135deg, rgba(192, 192, 192, 0.08), var(--glass-bg));
    }

    .leaderboard-card.rank-3 {
      border-color: rgba(205, 127, 50, 0.3);
      background: linear-gradient(135deg, rgba(205, 127, 50, 0.08), var(--glass-bg));
    }

    .rank-badge {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      background: var(--bg-surface);
      font-size: 1.25rem;
      font-weight: 800;
      flex-shrink: 0;
    }

    .rank-1 .rank-badge {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
      color: var(--gold);
    }

    .rank-2 .rank-badge {
      background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.05));
      color: var(--silver);
    }

    .rank-3 .rank-badge {
      background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.05));
      color: var(--bronze);
    }

    .card-info {
      flex: 1;
      min-width: 0;
    }

    .card-team-name {
      font-weight: 700;
      font-size: 1rem;
    }

    .card-portfolio-summary {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-stats {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      flex-shrink: 0;
    }

    .card-medals {
      display: flex;
      gap: var(--space-xs);
      font-size: 0.8125rem;
    }

    .card-points {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-gold);
      font-feature-settings: "tnum";
    }

    /* Portfolio Grid */
    .portfolios-section {
      padding-bottom: var(--space-xl);
    }

    .portfolio-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }

    .portfolio-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .portfolio-card::before {
      content: '';
      display: block;
      height: 4px;
      background: linear-gradient(90deg, var(--olympic-blue), var(--olympic-yellow), var(--olympic-green), var(--olympic-red));
    }

    .portfolio-card-header {
      padding: var(--space-md);
      border-bottom: var(--glass-border);
    }

    .portfolio-team-name {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 2px;
    }

    .portfolio-stats {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .portfolio-card-body {
      padding: var(--space-md);
    }

    .portfolio-country {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-sm) 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .portfolio-country:last-child { border-bottom: none; }

    .portfolio-country-info {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .portfolio-country-flag {
      font-size: 1.25rem;
    }

    .portfolio-country-name {
      font-size: 0.875rem;
    }

    .portfolio-country-medals {
      display: flex;
      gap: var(--space-xs);
      font-size: 0.75rem;
    }

    .portfolio-country-points {
      font-weight: 700;
      color: var(--accent-gold);
      min-width: 30px;
      text-align: right;
    }

    /* ========================================
       12. FOOTER
       ======================================== */
    .app-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--space-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      pointer-events: none;
      z-index: 100;
    }

    .footer-info {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      font-size: 0.75rem;
      color: var(--text-muted);
      pointer-events: all;
    }

    .admin-key-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--bg-surface);
      border: var(--glass-border);
      cursor: pointer;
      font-size: 1.125rem;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: all;
      opacity: 0.6;
      transition: all var(--transition-fast);
    }

    .admin-key-btn:hover {
      opacity: 1;
      background: var(--bg-elevated);
    }

    /* ========================================
       13. MODAL
       ======================================== */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    .modal-content {
      position: relative;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      background: var(--bg-surface);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) var(--space-lg);
      border-bottom: var(--glass-border);
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 700;
    }

    .close-btn {
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      border-radius: var(--radius-sm);
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .modal-body {
      padding: var(--space-lg);
      overflow-y: auto;
      flex: 1;
    }

    .admin-section {
      margin-bottom: var(--space-xl);
    }

    .admin-section:last-child { margin-bottom: 0; }

    .admin-section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-md);
    }

    .medal-buttons {
      display: flex;
      gap: var(--space-sm);
    }

    .medal-btn {
      flex: 1;
      padding: var(--space-sm);
      font-family: inherit;
      font-size: 0.8125rem;
      font-weight: 600;
      border: 2px solid transparent;
      border-radius: var(--radius-md);
      cursor: pointer;
      background: var(--bg-depth);
      color: var(--text-secondary);
      min-height: 44px;
      transition: all var(--transition-fast);
    }

    .medal-btn.selected {
      border-color: currentColor;
    }

    .medal-btn.gold.selected { color: var(--gold); background: rgba(255, 215, 0, 0.1); }
    .medal-btn.silver.selected { color: var(--silver); background: rgba(192, 192, 192, 0.1); }
    .medal-btn.bronze.selected { color: var(--bronze); background: rgba(205, 127, 50, 0.1); }

    .transaction-log {
      max-height: 200px;
      overflow-y: auto;
      background: var(--bg-depth);
      border-radius: var(--radius-md);
      padding: var(--space-sm);
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
    }

    .transaction-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .transaction-info { flex: 1; }

    .transaction-main {
      font-size: 0.875rem;
    }

    .transaction-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .transaction-delete {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-sm);
    }

    .transaction-delete:hover {
      background: rgba(255, 68, 68, 0.2);
      color: var(--danger);
    }

    .data-actions {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }

    .data-actions .btn { flex: 1; }

    #reopen-market-btn { width: 100%; margin-bottom: var(--space-sm); }
    #reset-btn { width: 100%; }

    .empty-state {
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: var(--space-md);
    }

    /* ========================================
       14. TOAST
       ======================================== */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-surface);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-lg);
      font-size: 0.875rem;
      z-index: 1100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    .toast.toast-success { border-color: var(--success); }
    .toast.toast-error { border-color: var(--danger); }

    /* ========================================
       15. BACK BUTTON
       ======================================== */
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      font-family: inherit;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-secondary);
      background: transparent;
      border: var(--glass-border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      margin-bottom: var(--space-xs);
    }

    .btn-back:hover {
      color: var(--text-primary);
      border-color: var(--accent-primary);
      background: rgba(0, 212, 255, 0.1);
    }

    /* ========================================
       16. COUNTDOWN TIMER
       ======================================== */
    .countdown-card {
      text-align: center;
      margin-bottom: var(--space-lg);
      padding: var(--space-md) var(--space-lg);
    }

    .countdown-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
    }

    .countdown-timer {
      display: flex;
      justify-content: center;
      gap: var(--space-md);
      flex-wrap: wrap;
    }

    .countdown-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
    }

    .countdown-value {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--accent-gold);
      font-feature-settings: "tnum";
      line-height: 1;
    }

    .countdown-label-text {
      font-size: 0.6875rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: var(--space-xs);
    }

    .countdown-live {
      color: var(--success);
      font-weight: 700;
      font-size: 1.125rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* ========================================
       17. REFRESH BUTTON & SECTION TITLE ROW
       ======================================== */
    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .section-title-row .section-title {
      margin-bottom: 0;
    }

    .btn-refresh {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-md);
      font-family: inherit;
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-secondary);
      background: var(--bg-surface);
      border: var(--glass-border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      min-height: 36px;
    }

    .btn-refresh:hover {
      color: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .btn-refresh.spinning {
      animation: spin 0.6s ease;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* ========================================
       18. COUNTRY LINK IN PORTFOLIO
       ======================================== */
    .portfolio-country-link {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      text-decoration: none;
      color: inherit;
      transition: color var(--transition-fast);
    }

    .portfolio-country-link:hover {
      color: var(--accent-primary);
    }

    .portfolio-country-link:hover .portfolio-country-name {
      text-decoration: underline;
    }

    /* ========================================
       19. RESPONSIVE
       ======================================== */
    @media (max-width: 767px) {
      .modal-content {
        max-height: 95vh;
      }

      .modal-body {
        padding: var(--space-md);
      }

      .medal-buttons {
        flex-direction: column;
      }

      .medal-btn {
        min-height: 48px;
      }

      .card-medals {
        flex-direction: column;
        gap: 0;
        font-size: 0.6875rem;
        text-align: right;
      }

      .countdown-value {
        font-size: 1.25rem;
      }
    }

    @media (min-width: 768px) {
      .container { padding: var(--space-lg); }

      .participant-list {
        grid-template-columns: repeat(2, 1fr);
      }

      .portfolio-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .modal {
        align-items: center;
      }

      .modal-content {
        border-radius: var(--radius-lg);
        max-height: 80vh;
      }
    }

    @media (min-width: 1024px) {
      .portfolio-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>

  <!-- ============================================ -->
  <!-- JAVASCRIPT                                   -->
  <!-- ============================================ -->
  <script>
    /* ========================================
       1. CONSTANTS
       ======================================== */

    const PARTICIPANTS = [
      { id: 1, name: 'Mike & Allegra Berry' },
      { id: 2, name: 'Christopher & Rebecca Wray' },
      { id: 3, name: 'Stephen & Rhandi Zipp' },
      { id: 4, name: 'Ryan & Haley Baskerville' },
      { id: 5, name: 'Preston & Maddi Amundson' },
      { id: 6, name: 'Jaynen & Britt Rissling' },
      { id: 7, name: 'Kieran & Zoe Armstrong' }
    ];

    const COUNTRIES = {
      // BLUE CHIPS ($26-40) ‚Äî 25+ medals projected
      'nor': {
        id: 'nor', name: 'Norway', flag: 'üá≥üá¥', price: 40, tier: 'blue-chip',
        projection: '~40 medals, ~17 golds',
        description: 'The undisputed king of winter. Kl√¶bo in XC, dominant Biathlon squad, and Russia\'s ban redistributes medals their way.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/nor'
      },
      'usa': {
        id: 'usa', name: 'USA', flag: 'üá∫üá∏', price: 32, tier: 'blue-chip',
        projection: '~32 medals, ~12 golds',
        description: 'NHL players return. Jordan Stolz dominates speed skating, Shiffrin seeks alpine redemption. Huge freestyle/snowboard depth.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/usa'
      },
      'ger': {
        id: 'ger', name: 'Germany', flag: 'üá©üá™', price: 29, tier: 'blue-chip',
        projection: '~29 medals, ~11 golds',
        description: 'The sliding sports monopoly. Luge, Bobsled, Skeleton fortress on the Cortina track. Strong Biathlon and Ski Jumping.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ger'
      },
      'can': {
        id: 'can', name: 'Canada', flag: 'üá®üá¶', price: 26, tier: 'blue-chip',
        projection: '~26 medals, ~8 golds',
        description: 'Crosby and McDavid finally team up. Men\'s Hockey is a "double gold" swing with the Women. Strong Freestyle and Short Track.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/can'
      },

      // MID-CAPS ($9-20) ‚Äî 9-20 medals projected
      'aut': {
        id: 'aut', name: 'Austria', flag: 'üá¶üáπ', price: 20, tier: 'mid-cap',
        projection: '~20 medals, ~7 golds',
        description: 'Alpine skiing royalty. Bormio slopes built for their technical squad. Plus Ski Jumping, Nordic Combined, and Luge.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/aut'
      },
      'swe': {
        id: 'swe', name: 'Sweden', flag: 'üá∏üá™', price: 19, tier: 'mid-cap',
        projection: '~19 medals, ~7 golds',
        description: 'The quiet achiever. Cross-country skiing depth, Biathlon relays, Curling, and NHL-boosted Hockey.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/swe'
      },
      'ita': {
        id: 'ita', name: 'Italy', flag: 'üáÆüáπ', price: 18, tier: 'mid-cap',
        projection: '~18 medals, ~5 golds (Host)',
        description: 'The Host Bump. Home-field advantage for Goggia and Brignone in alpine. New Ski Mountaineering events favor Italy heavily.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ita'
      },
      'sui': {
        id: 'sui', name: 'Switzerland', flag: 'üá®üá≠', price: 17, tier: 'mid-cap',
        projection: '~17 medals, ~6 golds',
        description: 'Marco Odermatt is the alpine GOAT-in-waiting. Ski Mountaineering, Snowboard Cross, and Bobsled add depth.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/sui'
      },
      'fra': {
        id: 'fra', name: 'France', flag: 'üá´üá∑', price: 16, tier: 'mid-cap',
        projection: '~16 medals, ~5 golds',
        description: 'Biathlon powerhouse plus alpine and freestyle upside. New Ski Mountaineering events are a boost.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/fra'
      },
      'ned': {
        id: 'ned', name: 'Netherlands', flag: 'üá≥üá±', price: 15, tier: 'mid-cap',
        projection: '~15 medals, ~6 golds',
        description: 'Speed Skating pure-play. Volatile: if the Milan oval is fast, they could return 20. Minimal diversification.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ned'
      },
      'jpn': {
        id: 'jpn', name: 'Japan', flag: 'üáØüáµ', price: 14, tier: 'mid-cap',
        projection: '~14 medals, ~4 golds',
        description: 'Figure skating excellence, Ski Jumping depth, Speed Skating, and Halfpipe specialists. Consistent and technical.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/jpn'
      },
      'kor': {
        id: 'kor', name: 'South Korea', flag: 'üá∞üá∑', price: 10, tier: 'mid-cap',
        projection: '~10 medals, ~3 golds',
        description: 'Short Track factory. Upgraded from penny stock after dominant 2024-25 World Cup season. One crash or DQ still hurts.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/kor'
      },
      'chn': {
        id: 'chn', name: 'China', flag: 'üá®üá≥', price: 9, tier: 'mid-cap',
        projection: '~9 medals, ~3 golds',
        description: 'Post-host correction from 15 in Beijing. Still elite in Short Track and Freestyle Aerials. Eileen Gu factor.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/chn'
      },
      'fin': {
        id: 'fin', name: 'Finland', flag: 'üá´üáÆ', price: 9, tier: 'mid-cap',
        projection: '~9 medals, ~2 golds',
        description: 'NHL-boosted Men\'s Hockey, Cross-country skiing, and Ski Jumping. Solid floor with hockey upside.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/fin'
      },

      // PENNY STOCKS ($1-7) ‚Äî 1-7 medals projected
      'cze': {
        id: 'cze', name: 'Czech Republic', flag: 'üá®üáø', price: 7, tier: 'penny-stock',
        projection: '~7 medals, ~2 golds',
        description: 'Ester Ledeck√° is a dual-sport superstar (alpine + snowboard). Biathlon squad and NHL Hockey add upside.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/cze'
      },
      'svn': {
        id: 'svn', name: 'Slovenia', flag: 'üá∏üáÆ', price: 5, tier: 'penny-stock',
        projection: '~5 medals, ~2 golds',
        description: 'Ski Jumping powerhouse for their size. Alpine skiing and Cross-country add sneaky value.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/svn'
      },
      'gbr': {
        id: 'gbr', name: 'Great Britain', flag: 'üá¨üáß', price: 4, tier: 'penny-stock',
        projection: '~4 medals',
        description: 'Curling is the anchor. Skeleton pedigree plus Freestyle upside with Mia Brookes in snowboard.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/gbr'
      },
      'aus': {
        id: 'aus', name: 'Australia', flag: 'üá¶üá∫', price: 4, tier: 'penny-stock',
        projection: '~4 medals',
        description: 'Efficient. Jakara Anthony (Moguls) and strong Halfpipe squad are near-locks. Best bang for your buck?',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/aus'
      },
      'nzl': {
        id: 'nzl', name: 'New Zealand', flag: 'üá≥üáø', price: 2, tier: 'penny-stock',
        projection: '~2 medals',
        description: 'Zoi Sadowski-Synnott hunts Snowboard gold. Low volume, but elite upside in Slopestyle and Big Air.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/nzl'
      },
      'hun': {
        id: 'hun', name: 'Hungary', flag: 'üá≠üá∫', price: 2, tier: 'penny-stock',
        projection: '~2 medals',
        description: 'Short Track speed skating specialists. Liu brothers carry the hopes. Boom-or-bust lottery ticket.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/hun'
      },
      'pol': {
        id: 'pol', name: 'Poland', flag: 'üáµüá±', price: 2, tier: 'penny-stock',
        projection: '~2 medals',
        description: 'Ski Jumping squad and Cross-country dark horses. Cheap diversification play.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/pol'
      },
      'svk': {
        id: 'svk', name: 'Slovakia', flag: 'üá∏üá∞', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Alpine skiing and Biathlon long shots. Petra Vlhov√°\'s comeback could pay off big.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/svk'
      },
      'bel': {
        id: 'bel', name: 'Belgium', flag: 'üáßüá™', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Skeleton and Speed Skating dark horse. The ultimate deep-value contrarian pick.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/bel'
      },
      'est': {
        id: 'est', name: 'Estonia', flag: 'üá™üá™', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Cross-country skiing specialists. Could surprise in Biathlon relays.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/est'
      },
      'lat': {
        id: 'lat', name: 'Latvia', flag: 'üá±üáª', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Bobsled, Luge, and Skeleton contenders. The Baltic sliding factory.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/lat'
      },
      'esp': {
        id: 'esp', name: 'Spain', flag: 'üá™üá∏', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'New Ski Mountaineering events are Spain\'s golden ticket. A true wildcard.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/esp'
      },
      'den': {
        id: 'den', name: 'Denmark', flag: 'üá©üá∞', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Curling and Speed Skating hopefuls. Low probability, but costs nothing.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/den'
      },
      'ukr': {
        id: 'ukr', name: 'Ukraine', flag: 'üá∫üá¶', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Biathlon and Freestyle skiing contenders. Resilient program competing against the odds.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ukr'
      },
      'kaz': {
        id: 'kaz', name: 'Kazakhstan', flag: 'üá∞üáø', price: 1, tier: 'penny-stock',
        projection: '~1 medal',
        description: 'Cross-country skiing and Freestyle dark horse. Central Asian wildcard at the minimum price.',
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/kaz'
      }
    };

    const BUDGET = 100;
    const MEDAL_POINTS = { gold: 3, silver: 2, bronze: 1 };
    const MEDAL_EMOJI = { gold: 'ü•á', silver: 'ü•à', bronze: 'ü•â' };
    const STORAGE_KEY = 'milan2026_market_v3';
    const ADMIN_PASSCODE = 'gold';

    /* ========================================
       2. STATE
       ======================================== */

    let appState = {
      portfolios: {},    // participantId -> [countryIds]
      medalsLog: [],     // { id, countryId, eventDescription, medal, timestamp }
      marketOpen: true
    };

    let currentParticipantId = null;
    let currentCart = [];
    let selectedMedalType = null;

    /* ========================================
       3. STATE MANAGEMENT
       ======================================== */

    function loadState() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          appState = JSON.parse(saved);
          if (!appState.portfolios) appState.portfolios = {};
          if (!appState.medalsLog) appState.medalsLog = [];
          if (appState.marketOpen === undefined) appState.marketOpen = true;
        }
      } catch (e) {
        console.error('Failed to load state:', e);
        appState = { portfolios: {}, medalsLog: [], marketOpen: true };
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
      } catch (e) {
        console.error('Failed to save state:', e);
      }
    }

    /* ========================================
       4. UTILITIES
       ======================================== */

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
    }

    function formatTimestamp(ts) {
      return new Date(ts).toLocaleDateString('en-US', {
        month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
      });
    }

    function getParticipantById(id) {
      return PARTICIPANTS.find(p => p.id === id);
    }

    function getCountryById(id) {
      return COUNTRIES[id];
    }

    function isPortfolioComplete(participantId) {
      return appState.portfolios[participantId] && appState.portfolios[participantId].length > 0;
    }

    function allPortfoliosComplete() {
      return PARTICIPANTS.every(p => isPortfolioComplete(p.id));
    }

    function getCartTotal() {
      return currentCart.reduce((sum, id) => sum + COUNTRIES[id].price, 0);
    }

    function getRemainingBudget() {
      return BUDGET - getCartTotal();
    }

    /* ========================================
       5. SCORING
       ======================================== */

    function getMedalsForCountry(countryId) {
      return appState.medalsLog.filter(m => m.countryId === countryId);
    }

    function getPointsForCountry(countryId) {
      const medals = getMedalsForCountry(countryId);
      return medals.reduce((sum, m) => sum + MEDAL_POINTS[m.medal], 0);
    }

    function getMedalCountsForCountry(countryId) {
      const medals = getMedalsForCountry(countryId);
      return {
        gold: medals.filter(m => m.medal === 'gold').length,
        silver: medals.filter(m => m.medal === 'silver').length,
        bronze: medals.filter(m => m.medal === 'bronze').length
      };
    }

    function getScoresForParticipant(participantId) {
      const portfolio = appState.portfolios[participantId] || [];
      let total = 0, gold = 0, silver = 0, bronze = 0;

      portfolio.forEach(countryId => {
        total += getPointsForCountry(countryId);
        const counts = getMedalCountsForCountry(countryId);
        gold += counts.gold;
        silver += counts.silver;
        bronze += counts.bronze;
      });

      return { total, gold, silver, bronze };
    }

    function getLeaderboard() {
      return PARTICIPANTS.map(p => ({
        participant: p,
        portfolio: appState.portfolios[p.id] || [],
        scores: getScoresForParticipant(p.id)
      })).sort((a, b) => {
        if (b.scores.total !== a.scores.total) return b.scores.total - a.scores.total;
        return b.scores.gold - a.scores.gold;
      });
    }

    function getTotalLeaguePoints() {
      return PARTICIPANTS.reduce((sum, p) => sum + getScoresForParticipant(p.id).total, 0);
    }

    /* ========================================
       6. VIEWS
       ======================================== */

    function showView(viewId) {
      document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
      document.getElementById(viewId).classList.remove('hidden');
    }

    function render() {
      if (appState.marketOpen && !allPortfoliosComplete()) {
        showView('welcome-view');
      } else {
        showView('dashboard-view');
        renderDashboard();
      }
    }

    /* ========================================
       7. WELCOME VIEW
       ======================================== */

    const INTRO_VIDEO_ID = 'dcJb-MrHypI';

    function enterMarket() {
      showView('video-view');
      // Load video with autoplay
      const iframe = document.getElementById('intro-video');
      iframe.src = `https://www.youtube.com/embed/${INTRO_VIDEO_ID}?autoplay=1&rel=0&modestbranding=1`;
    }

    function skipVideo() {
      // Stop video
      const iframe = document.getElementById('intro-video');
      iframe.src = '';
      // Go to participant selection
      showView('participant-view');
      renderParticipantList();
    }

    function continueToDraft() {
      skipVideo(); // Same behavior, just different button
    }

    /* ========================================
       8. PARTICIPANT SELECTION
       ======================================== */

    function renderParticipantList() {
      const container = document.getElementById('participant-list');
      container.innerHTML = PARTICIPANTS.map(p => {
        const complete = isPortfolioComplete(p.id);
        return `
          <div class="participant-card ${complete ? 'completed' : ''}" data-id="${p.id}">
            <span class="participant-name">${p.name}</span>
          </div>
        `;
      }).join('');

      container.querySelectorAll('.participant-card:not(.completed)').forEach(card => {
        card.addEventListener('click', () => {
          currentParticipantId = parseInt(card.dataset.id);
          currentCart = [];
          showView('market-view');
          renderMarket();
        });
      });
    }

    /* ========================================
       9. MARKET VIEW
       ======================================== */

    function renderMarket() {
      const participant = getParticipantById(currentParticipantId);
      document.getElementById('current-buyer').textContent = `Building for: ${participant.name}`;

      renderBudget();
      renderCart();
      renderCountryGrids();
      updateConfirmButton();
    }

    function renderBudget() {
      const remaining = getRemainingBudget();
      const pct = (remaining / BUDGET) * 100;
      const amountEl = document.getElementById('budget-amount');
      const fillEl = document.getElementById('budget-fill');

      amountEl.textContent = `$${remaining}`;
      amountEl.className = 'budget-amount';
      if (remaining < 20) amountEl.classList.add('danger');
      else if (remaining < 50) amountEl.classList.add('warning');

      fillEl.style.width = `${pct}%`;
    }

    function renderCart() {
      const container = document.getElementById('cart-items');
      const totalEl = document.getElementById('cart-total-amount');

      if (currentCart.length === 0) {
        container.innerHTML = '<p class="empty-cart">No countries selected yet</p>';
      } else {
        container.innerHTML = currentCart.map(id => {
          const c = COUNTRIES[id];
          return `
            <div class="cart-item">
              <div class="cart-item-info">
                <span>${c.flag}</span>
                <span>${c.name}</span>
                <span style="color: var(--accent-gold)">$${c.price}</span>
              </div>
              <button class="cart-item-remove" data-id="${id}">‚úï</button>
            </div>
          `;
        }).join('');

        container.querySelectorAll('.cart-item-remove').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            removeFromCart(btn.dataset.id);
          });
        });
      }

      totalEl.textContent = `$${getCartTotal()}`;
    }

    function renderCountryGrids() {
      const tiers = {
        'blue-chip': document.getElementById('blue-chip-grid'),
        'mid-cap': document.getElementById('mid-cap-grid'),
        'penny-stock': document.getElementById('penny-stock-grid')
      };

      Object.values(tiers).forEach(el => el.innerHTML = '');

      Object.values(COUNTRIES).forEach(country => {
        const inCart = currentCart.includes(country.id);
        const canAfford = getRemainingBudget() >= country.price;
        const disabled = !inCart && !canAfford;

        const card = document.createElement('div');
        card.className = `country-card ${inCart ? 'selected' : ''} ${disabled ? 'disabled' : ''}`;
        card.innerHTML = `
          ${inCart ? '<div class="country-selected-badge">IN CART</div>' : ''}
          <div class="country-header">
            <span class="country-flag">${country.flag}</span>
            <span class="country-price">$${country.price}</span>
          </div>
          <div class="country-name">${country.name}</div>
          <div class="country-projection">üìä ${country.projection}</div>
          <div class="country-desc">${country.description}</div>
        `;

        if (!disabled) {
          card.addEventListener('click', () => toggleCountry(country.id));
        }

        tiers[country.tier].appendChild(card);
      });
    }

    function toggleCountry(countryId) {
      if (currentCart.includes(countryId)) {
        removeFromCart(countryId);
      } else {
        addToCart(countryId);
      }
    }

    function addToCart(countryId) {
      if (!currentCart.includes(countryId) && getRemainingBudget() >= COUNTRIES[countryId].price) {
        currentCart.push(countryId);
        renderMarket();
      }
    }

    function removeFromCart(countryId) {
      currentCart = currentCart.filter(id => id !== countryId);
      renderMarket();
    }

    function clearCart() {
      currentCart = [];
      renderMarket();
    }

    function updateConfirmButton() {
      const btn = document.getElementById('confirm-portfolio-btn');
      btn.disabled = currentCart.length === 0;
    }

    function confirmPortfolio() {
      if (currentCart.length === 0) return;

      const participant = getParticipantById(currentParticipantId);
      const spent = getCartTotal();

      if (!confirm(`Confirm portfolio for ${participant.name}?\n\nCountries: ${currentCart.map(id => COUNTRIES[id].name).join(', ')}\nTotal: $${spent}`)) {
        return;
      }

      appState.portfolios[currentParticipantId] = [...currentCart];
      saveState();

      showToast(`Portfolio confirmed for ${participant.name}!`, 'success');

      currentParticipantId = null;
      currentCart = [];

      if (allPortfoliosComplete()) {
        appState.marketOpen = false;
        saveState();
        render();
      } else {
        showView('participant-view');
        renderParticipantList();
      }
    }

    /* ========================================
       10. DASHBOARD
       ======================================== */

    function renderDashboard() {
      renderTotalPoints();
      renderLastUpdated();
      renderLeaderboard();
      renderPortfolios();
    }

    function renderTotalPoints() {
      document.getElementById('total-medal-count').textContent = getTotalLeaguePoints();
    }

    function renderLastUpdated() {
      const el = document.getElementById('last-updated');
      if (appState.medalsLog.length === 0) {
        el.textContent = '';
        return;
      }
      const last = appState.medalsLog[appState.medalsLog.length - 1];
      el.textContent = `Updated ${formatTimestamp(last.timestamp)}`;
    }

    function renderLeaderboard() {
      const leaderboard = getLeaderboard();
      const container = document.getElementById('leaderboard-cards');

      container.innerHTML = leaderboard.map((entry, idx) => {
        const rank = idx + 1;
        const { participant, portfolio, scores } = entry;
        const countryFlags = portfolio.map(id => COUNTRIES[id].flag).join(' ');
        const totalMedals = scores.gold + scores.silver + scores.bronze;

        return `
          <div class="leaderboard-card rank-${rank <= 3 ? rank : 'other'}">
            <div class="rank-badge">${rank}</div>
            <div class="card-info">
              <div class="card-team-name">${participant.name}</div>
              <div class="card-portfolio-summary">${countryFlags || 'No portfolio'}</div>
            </div>
            <div class="card-stats">
              <div class="card-medals">
                <span style="color: var(--gold)">${scores.gold}G</span>
                <span style="color: var(--silver)">${scores.silver}S</span>
                <span style="color: var(--bronze)">${scores.bronze}B</span>
                <span style="color: var(--text-muted); font-size: 0.75rem">(${totalMedals})</span>
              </div>
              <div class="card-points">${scores.total}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderPortfolios() {
      const container = document.getElementById('portfolio-grid');

      container.innerHTML = PARTICIPANTS.map(p => {
        const portfolio = appState.portfolios[p.id] || [];
        const scores = getScoresForParticipant(p.id);
        const spent = portfolio.reduce((sum, id) => sum + COUNTRIES[id].price, 0);

        const countriesHtml = portfolio.length === 0
          ? '<p class="empty-state">No portfolio set</p>'
          : portfolio.map(id => {
              const c = COUNTRIES[id];
              const counts = getMedalCountsForCountry(id);
              const pts = getPointsForCountry(id);
              return `
                <div class="portfolio-country">
                  <a href="${c.olympicsUrl}" target="_blank" rel="noopener" class="portfolio-country-link" title="View ${c.name} on Olympics.com">
                    <span class="portfolio-country-flag">${c.flag}</span>
                    <span class="portfolio-country-name">${c.name} ($${c.price})</span>
                  </a>
                  <div class="portfolio-country-medals">
                    ${counts.gold ? `<span style="color:var(--gold)">${counts.gold}G</span>` : ''}
                    ${counts.silver ? `<span style="color:var(--silver)">${counts.silver}S</span>` : ''}
                    ${counts.bronze ? `<span style="color:var(--bronze)">${counts.bronze}B</span>` : ''}
                  </div>
                  <div class="portfolio-country-points">${pts}</div>
                </div>
              `;
            }).join('');

        return `
          <div class="portfolio-card">
            <div class="portfolio-card-header">
              <div class="portfolio-team-name">${p.name}</div>
              <div class="portfolio-stats">Spent: $${spent} | Points: ${scores.total}</div>
            </div>
            <div class="portfolio-card-body">
              ${countriesHtml}
            </div>
          </div>
        `;
      }).join('');
    }

    /* ========================================
       11. ADMIN
       ======================================== */

    function openAdmin() {
      const pass = prompt('Enter commissioner passcode:');
      if (pass !== ADMIN_PASSCODE) {
        if (pass !== null) showToast('Access denied', 'error');
        return;
      }
      document.getElementById('admin-modal').classList.remove('hidden');
      renderAdminPanel();
    }

    function closeAdmin() {
      document.getElementById('admin-modal').classList.add('hidden');
      resetAdminForm();
    }

    function renderAdminPanel() {
      renderCountrySelect();
      renderTransactionLog();
      resetAdminForm();
    }

    function renderCountrySelect() {
      const select = document.getElementById('country-select');
      const sorted = Object.values(COUNTRIES).sort((a, b) => a.name.localeCompare(b.name));
      select.innerHTML = `<option value="">-- Select country --</option>` +
        sorted.map(c => `<option value="${c.id}">${c.flag} ${c.name}</option>`).join('');
    }

    function renderTransactionLog() {
      const container = document.getElementById('transaction-log');
      if (appState.medalsLog.length === 0) {
        container.innerHTML = '<p class="empty-state">No medals recorded yet</p>';
        return;
      }

      const recent = [...appState.medalsLog].reverse().slice(0, 15);
      container.innerHTML = recent.map(entry => {
        const c = COUNTRIES[entry.countryId];
        return `
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-main">${MEDAL_EMOJI[entry.medal]} ${c.flag} ${c.name} - ${entry.eventDescription}</div>
              <div class="transaction-time">${formatTimestamp(entry.timestamp)}</div>
            </div>
            <button class="transaction-delete" data-id="${entry.id}">‚úï</button>
          </div>
        `;
      }).join('');

      container.querySelectorAll('.transaction-delete').forEach(btn => {
        btn.addEventListener('click', () => removeMedal(btn.dataset.id));
      });
    }

    function resetAdminForm() {
      document.getElementById('country-select').value = '';
      document.getElementById('event-input').value = '';
      selectedMedalType = null;
      document.querySelectorAll('.medal-btn').forEach(b => b.classList.remove('selected'));
      updateAddMedalButton();
    }

    function updateAddMedalButton() {
      const country = document.getElementById('country-select').value;
      const event = document.getElementById('event-input').value.trim();
      document.getElementById('add-medal-btn').disabled = !country || !event || !selectedMedalType;
    }

    function addMedal() {
      const countryId = document.getElementById('country-select').value;
      const eventDesc = document.getElementById('event-input').value.trim();
      if (!countryId || !eventDesc || !selectedMedalType) return;

      const c = COUNTRIES[countryId];
      if (!confirm(`Record ${selectedMedalType.toUpperCase()} for ${c.flag} ${c.name}?\nEvent: ${eventDesc}`)) return;

      appState.medalsLog.push({
        id: generateId(),
        countryId,
        eventDescription: eventDesc,
        medal: selectedMedalType,
        timestamp: Date.now()
      });
      saveState();

      showToast(`${MEDAL_EMOJI[selectedMedalType]} Medal recorded!`, 'success');
      resetAdminForm();
      renderTransactionLog();
      renderDashboard();
    }

    function removeMedal(medalId) {
      if (!confirm('Remove this medal?')) return;
      appState.medalsLog = appState.medalsLog.filter(m => m.id !== medalId);
      saveState();
      showToast('Medal removed', 'success');
      renderTransactionLog();
      renderDashboard();
    }

    function reopenMarket() {
      if (!confirm('Reopen the market? This will allow portfolio changes.')) return;
      appState.marketOpen = true;
      saveState();
      closeAdmin();
      render();
    }

    function exportData() {
      navigator.clipboard.writeText(JSON.stringify(appState, null, 2));
      showToast('Data copied!', 'success');
    }

    function importData() {
      const json = prompt('Paste JSON:');
      if (!json) return;
      try {
        appState = JSON.parse(json);
        saveState();
        showToast('Imported!', 'success');
        closeAdmin();
        render();
      } catch (e) {
        showToast('Invalid JSON', 'error');
      }
    }

    function resetLeague() {
      if (!confirm('DELETE ALL DATA?')) return;
      if (prompt('Type RESET:') !== 'RESET') return;
      localStorage.removeItem(STORAGE_KEY);
      appState = { portfolios: {}, medalsLog: [], marketOpen: true };
      closeAdmin();
      render();
    }

    /* ========================================
       12. TOAST
       ======================================== */

    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = `toast toast-${type}`;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    /* ========================================
       13. SNOWFALL
       ======================================== */

    function createSnowfall() {
      const container = document.getElementById('snowfall');
      const flakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚ú¶', '‚úß'];
      for (let i = 0; i < 25; i++) {
        const s = document.createElement('span');
        s.className = 'snowflake';
        s.textContent = flakes[Math.floor(Math.random() * flakes.length)];
        s.style.left = Math.random() * 100 + '%';
        s.style.animationDuration = (Math.random() * 12 + 8) + 's';
        s.style.animationDelay = Math.random() * 8 + 's';
        s.style.fontSize = (Math.random() * 0.8 + 0.4) + 'rem';
        s.style.opacity = Math.random() * 0.5 + 0.2;
        container.appendChild(s);
      }
    }

    /* ========================================
       14. COUNTDOWN TIMER
       ======================================== */

    const OPENING_CEREMONY = new Date('2026-02-06T20:00:00+01:00'); // Milan time (CET)

    function updateCountdown() {
      const el = document.getElementById('countdown-timer');
      const card = document.getElementById('countdown-card');
      if (!el || !card) return;

      const now = new Date();
      const diff = OPENING_CEREMONY - now;

      if (diff <= 0) {
        el.innerHTML = '<span class="countdown-live">The Games Are LIVE!</span>';
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      el.innerHTML = [
        { value: days, label: 'Days' },
        { value: hours, label: 'Hours' },
        { value: minutes, label: 'Min' },
        { value: seconds, label: 'Sec' }
      ].map(u => `
        <div class="countdown-unit">
          <span class="countdown-value">${String(u.value).padStart(2, '0')}</span>
          <span class="countdown-label-text">${u.label}</span>
        </div>
      `).join('');
    }

    /* ========================================
       14B. BACK NAVIGATION
       ======================================== */

    function goBackToParticipants() {
      currentParticipantId = null;
      currentCart = [];
      showView('participant-view');
      renderParticipantList();
    }

    /* ========================================
       14C. EVENT SUGGESTIONS
       ======================================== */

    const EVENT_SUGGESTIONS = [
      "Men's Downhill Alpine Skiing",
      "Women's Downhill Alpine Skiing",
      "Men's Super-G Alpine Skiing",
      "Women's Super-G Alpine Skiing",
      "Men's Giant Slalom Alpine Skiing",
      "Women's Giant Slalom Alpine Skiing",
      "Men's Slalom Alpine Skiing",
      "Women's Slalom Alpine Skiing",
      "Men's Combined Alpine Skiing",
      "Women's Combined Alpine Skiing",
      "Mixed Team Parallel Alpine Skiing",
      "Men's 10km Sprint Biathlon",
      "Women's 7.5km Sprint Biathlon",
      "Men's 20km Individual Biathlon",
      "Women's 15km Individual Biathlon",
      "Men's 12.5km Pursuit Biathlon",
      "Women's 10km Pursuit Biathlon",
      "Men's 15km Mass Start Biathlon",
      "Women's 12.5km Mass Start Biathlon",
      "Men's 4x7.5km Relay Biathlon",
      "Women's 4x6km Relay Biathlon",
      "Mixed Relay Biathlon",
      "Two-Man Bobsled",
      "Four-Man Bobsled",
      "Two-Woman Bobsled",
      "Women's Monobob",
      "Men's Sprint Cross-Country Skiing",
      "Women's Sprint Cross-Country Skiing",
      "Men's Team Sprint Cross-Country Skiing",
      "Women's Team Sprint Cross-Country Skiing",
      "Men's 15km Classic Cross-Country Skiing",
      "Women's 10km Classic Cross-Country Skiing",
      "Men's Skiathlon Cross-Country Skiing",
      "Women's Skiathlon Cross-Country Skiing",
      "Men's 50km Mass Start Cross-Country Skiing",
      "Women's 30km Mass Start Cross-Country Skiing",
      "Men's 4x10km Relay Cross-Country Skiing",
      "Women's 4x5km Relay Cross-Country Skiing",
      "Men's Curling",
      "Women's Curling",
      "Mixed Doubles Curling",
      "Men's Singles Figure Skating",
      "Women's Singles Figure Skating",
      "Pairs Figure Skating",
      "Ice Dance Figure Skating",
      "Team Event Figure Skating",
      "Men's Moguls Freestyle Skiing",
      "Women's Moguls Freestyle Skiing",
      "Men's Aerials Freestyle Skiing",
      "Women's Aerials Freestyle Skiing",
      "Mixed Team Aerials Freestyle Skiing",
      "Men's Halfpipe Freestyle Skiing",
      "Women's Halfpipe Freestyle Skiing",
      "Men's Slopestyle Freestyle Skiing",
      "Women's Slopestyle Freestyle Skiing",
      "Men's Ski Cross Freestyle Skiing",
      "Women's Ski Cross Freestyle Skiing",
      "Men's Ice Hockey",
      "Women's Ice Hockey",
      "Men's Singles Luge",
      "Women's Singles Luge",
      "Doubles Luge",
      "Team Relay Luge",
      "Men's Normal Hill Ski Jumping",
      "Men's Large Hill Ski Jumping",
      "Women's Normal Hill Ski Jumping",
      "Men's Team Large Hill Ski Jumping",
      "Mixed Team Ski Jumping",
      "Men's Individual Gundersen NH/10km Nordic Combined",
      "Men's Individual Gundersen LH/10km Nordic Combined",
      "Men's Team Gundersen LH/4x5km Nordic Combined",
      "Men's 500m Short Track Speed Skating",
      "Women's 500m Short Track Speed Skating",
      "Men's 1000m Short Track Speed Skating",
      "Women's 1000m Short Track Speed Skating",
      "Men's 1500m Short Track Speed Skating",
      "Women's 1500m Short Track Speed Skating",
      "Men's 5000m Relay Short Track Speed Skating",
      "Women's 3000m Relay Short Track Speed Skating",
      "Mixed Team Relay Short Track Speed Skating",
      "Men's Skeleton",
      "Women's Skeleton",
      "Men's Sprint Ski Mountaineering",
      "Women's Sprint Ski Mountaineering",
      "Men's Individual Ski Mountaineering",
      "Women's Individual Ski Mountaineering",
      "Mixed Relay Ski Mountaineering",
      "Men's Big Air Snowboard",
      "Women's Big Air Snowboard",
      "Men's Halfpipe Snowboard",
      "Women's Halfpipe Snowboard",
      "Men's Slopestyle Snowboard",
      "Women's Slopestyle Snowboard",
      "Men's Snowboard Cross",
      "Women's Snowboard Cross",
      "Mixed Team Snowboard Cross",
      "Men's Parallel Giant Slalom Snowboard",
      "Women's Parallel Giant Slalom Snowboard",
      "Men's 500m Speed Skating",
      "Women's 500m Speed Skating",
      "Men's 1000m Speed Skating",
      "Women's 1000m Speed Skating",
      "Men's 1500m Speed Skating",
      "Women's 1500m Speed Skating",
      "Men's 5000m Speed Skating",
      "Women's 3000m Speed Skating",
      "Men's 10000m Speed Skating",
      "Women's 5000m Speed Skating",
      "Men's Mass Start Speed Skating",
      "Women's Mass Start Speed Skating",
      "Men's Team Pursuit Speed Skating",
      "Women's Team Pursuit Speed Skating"
    ];

    function populateEventSuggestions() {
      const datalist = document.getElementById('event-suggestions');
      if (!datalist) return;
      datalist.innerHTML = EVENT_SUGGESTIONS.map(e => `<option value="${e}">`).join('');
    }

    /* ========================================
       14D. REFRESH DASHBOARD
       ======================================== */

    function refreshDashboard() {
      const btn = document.getElementById('refresh-dashboard-btn');
      if (btn) {
        btn.classList.add('spinning');
        setTimeout(() => btn.classList.remove('spinning'), 600);
      }
      loadState();
      renderDashboard();
      showToast('Dashboard refreshed', 'success');
    }

    /* ========================================
       15. EVENT LISTENERS
       ======================================== */

    function initEventListeners() {
      // Welcome
      document.getElementById('enter-market-btn').addEventListener('click', enterMarket);

      // Video interstitial
      document.getElementById('continue-to-draft-btn').addEventListener('click', continueToDraft);
      document.getElementById('skip-video-btn').addEventListener('click', skipVideo);

      // Market
      document.getElementById('back-to-participants-btn').addEventListener('click', goBackToParticipants);
      document.getElementById('confirm-portfolio-btn').addEventListener('click', confirmPortfolio);
      document.getElementById('clear-cart-btn').addEventListener('click', clearCart);

      // Dashboard
      document.getElementById('refresh-dashboard-btn').addEventListener('click', refreshDashboard);

      // Admin
      document.getElementById('admin-key-btn').addEventListener('click', openAdmin);
      document.getElementById('close-modal-btn').addEventListener('click', closeAdmin);
      document.getElementById('modal-backdrop').addEventListener('click', closeAdmin);

      document.querySelectorAll('.medal-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.medal-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedMedalType = btn.dataset.medal;
          updateAddMedalButton();
        });
      });

      document.getElementById('country-select').addEventListener('change', updateAddMedalButton);
      document.getElementById('event-input').addEventListener('input', updateAddMedalButton);
      document.getElementById('add-medal-btn').addEventListener('click', addMedal);

      document.getElementById('export-btn').addEventListener('click', exportData);
      document.getElementById('import-btn').addEventListener('click', importData);
      document.getElementById('reopen-market-btn').addEventListener('click', reopenMarket);
      document.getElementById('reset-btn').addEventListener('click', resetLeague);

      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeAdmin();
      });
    }

    /* ========================================
       15. INIT
       ======================================== */

    function init() {
      createSnowfall();
      loadState();
      initEventListeners();
      populateEventSuggestions();
      updateCountdown();
      setInterval(updateCountdown, 1000);
      render();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
