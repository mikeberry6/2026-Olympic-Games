<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Milan 2026 Olympic Fantasy League - Track medals and compete with friends">
  <meta name="theme-color" content="#050505">
  <title>Milan 2026 Fantasy League</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Snowfall Animation Container -->
  <div class="snowfall" id="snowfall"></div>

  <!-- ============================================ -->
  <!-- VIEW A: DRAFT SELECTION                      -->
  <!-- ============================================ -->
  <section id="draft-view" class="view">
    <div class="container">
      <header class="draft-header">
        <div class="olympic-rings">‚óè‚óè‚óè‚óè‚óè</div>
        <h1 class="logo"><span class="city">Milano Cortina</span><span class="year">2026</span></h1>
        <p class="subtitle">‚õ∑Ô∏è Fantasy League Draft üèÇ</p>
        <p class="tagline">Build Your Championship Team</p>
      </header>

      <div class="draft-instructions">
        <p>Assign each team a bundle. Each bundle can only be selected once.</p>
      </div>

      <div id="draft-list" class="draft-list">
        <!-- Populated by JS -->
      </div>

      <button id="lock-draft-btn" class="btn btn-primary btn-large" disabled>
        <span class="lock-icon">üîí</span> Lock Draft
      </button>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- VIEW B: DASHBOARD                            -->
  <!-- ============================================ -->
  <section id="dashboard-view" class="view hidden">
    <div class="container">
      <header class="dashboard-header">
        <div class="header-top">
          <div class="header-brand">
            <div class="olympic-rings small">‚óè‚óè‚óè‚óè‚óè</div>
            <h1 class="logo"><span class="city">Milano Cortina</span><span class="year">2026</span></h1>
          </div>
          <div class="total-medals">
            <div class="medal-trophy">üèÜ</div>
            <span class="medal-count" id="total-medal-count">0</span>
            <span class="medal-label">Total Medals</span>
          </div>
        </div>
      </header>

      <!-- Leaderboard Section -->
      <section class="leaderboard-section">
        <h2 class="section-title">üèÖ Leaderboard</h2>

        <!-- Mobile: Card View -->
        <div id="leaderboard-cards" class="leaderboard-cards">
          <!-- Populated by JS -->
        </div>

        <!-- Desktop: Table View -->
        <div class="table-wrapper">
          <table id="leaderboard-table" class="leaderboard-table">
            <thead>
              <tr>
                <th class="col-rank">#</th>
                <th class="col-team">Team</th>
                <th class="col-bundle">Bundle</th>
                <th class="col-medal">G</th>
                <th class="col-medal">S</th>
                <th class="col-medal">B</th>
                <th class="col-points">Pts</th>
              </tr>
            </thead>
            <tbody id="leaderboard-tbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Team Rosters Section -->
      <section class="rosters-section">
        <h2 class="section-title">Team Rosters</h2>
        <div id="roster-grid" class="roster-grid">
          <!-- Populated by JS -->
        </div>
      </section>
    </div>

    <!-- Footer with Admin Access -->
    <footer class="app-footer">
      <div class="footer-info">
        <span class="version">v2.0</span>
        <span class="last-updated" id="last-updated"></span>
      </div>
      <button id="admin-key-btn" class="admin-key-btn" aria-label="Admin access">
        üîë
      </button>
    </footer>
  </section>

  <!-- ============================================ -->
  <!-- VIEW C: ADMIN CONSOLE (Modal)               -->
  <!-- ============================================ -->
  <div id="admin-modal" class="modal hidden" role="dialog" aria-labelledby="admin-title" aria-modal="true">
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="modal-content">
      <header class="modal-header">
        <h2 id="admin-title" class="modal-title">Admin Console</h2>
        <button id="close-modal-btn" class="close-btn" aria-label="Close">&times;</button>
      </header>

      <div class="modal-body">
        <!-- Add Medal Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">Add Medal</h3>

          <div class="form-group">
            <label for="entity-select">Select Entity</label>
            <select id="entity-select" class="form-select">
              <option value="">-- Select athlete/team --</option>
              <!-- Populated by JS -->
            </select>
          </div>

          <div class="form-group">
            <label for="event-input">Event Description</label>
            <input type="text" id="event-input" class="form-input" placeholder="e.g., Men's 1000m Speed Skating">
          </div>

          <div class="form-group">
            <label>Medal Type</label>
            <div class="medal-buttons">
              <button type="button" class="medal-btn gold" data-medal="gold">ü•á Gold</button>
              <button type="button" class="medal-btn silver" data-medal="silver">ü•à Silver</button>
              <button type="button" class="medal-btn bronze" data-medal="bronze">ü•â Bronze</button>
            </div>
          </div>

          <button id="add-medal-btn" class="btn btn-primary" disabled>Add Medal</button>
        </section>

        <!-- Transaction Log Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">Recent Transactions</h3>
          <div id="transaction-log" class="transaction-log">
            <p class="empty-state">No medals recorded yet</p>
          </div>
        </section>

        <!-- Data Management Section -->
        <section class="admin-section">
          <h3 class="admin-section-title">Data Management</h3>
          <div class="data-actions">
            <button id="export-btn" class="btn btn-secondary">üìã Export JSON</button>
            <button id="import-btn" class="btn btn-secondary">üì• Import JSON</button>
          </div>
          <button id="edit-draft-btn" class="btn btn-warning">‚úèÔ∏è Edit Draft</button>
          <button id="reset-btn" class="btn btn-danger">üóëÔ∏è Reset League</button>
        </section>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast hidden" role="alert" aria-live="polite"></div>

  <!-- ============================================ -->
  <!-- STYLES                                       -->
  <!-- ============================================ -->
  <style>
    /* ========================================
       1. CSS VARIABLES - Milano Cortina 2026 Theme
       ======================================== */
    :root {
      /* Milano Cortina 2026 Inspired Colors */
      --bg-depth: #0a0e1a;
      --bg-surface: #141c2f;
      --glass-border: 1px solid rgba(255, 255, 255, 0.12);
      --glass-bg: rgba(20, 28, 47, 0.7);

      /* Italian Flag + Olympic Colors */
      --italian-green: #008C45;
      --italian-red: #CD212A;
      --olympic-blue: #0081C8;
      --olympic-yellow: #FCB131;
      --olympic-black: #000000;
      --olympic-green: #00A651;
      --olympic-red: #EE334E;

      /* Primary Accent - Ice Blue */
      --accent-primary: #00D4FF;
      --accent-secondary: #7B68EE;
      --accent-tertiary: #FF6B9D;

      --text-primary: #FFFFFF;
      --text-secondary: #B8C5D6;
      --text-muted: #7A8BA3;

      /* Enhanced Medal Colors */
      --gold-start: #FFD700;
      --gold-mid: #FFEC8B;
      --gold-end: #DAA520;
      --silver-start: #E8E8E8;
      --silver-mid: #FFFFFF;
      --silver-end: #A8A8A8;
      --bronze-start: #CD7F32;
      --bronze-mid: #DDA15E;
      --bronze-end: #8B4513;

      /* Semantic Colors */
      --success: #00E676;
      --warning: #FFAB00;
      --danger: #FF5252;

      /* Typography */
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --header-tracking: -0.02em;

      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;

      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-bounce: 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    /* ========================================
       2. RESET & BASE + ANIMATED BACKGROUND
       ======================================== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-depth);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: relative;
    }

    /* Animated Gradient Background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(0, 140, 69, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(0, 129, 200, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(205, 33, 42, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(252, 177, 49, 0.1) 0%, transparent 50%);
      animation: gradientShift 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    /* Snowfall Effect */
    .snowfall {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 1rem;
      animation: fall linear infinite;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }

    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
      }
    }

    /* ========================================
       3. TYPOGRAPHY - Olympic Style
       ======================================== */
    h1, h2, h3, h4, h5, h6 {
      letter-spacing: var(--header-tracking);
      font-weight: 700;
      line-height: 1.2;
    }

    .logo {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      text-transform: uppercase;
      position: relative;
      display: inline-block;
    }

    .logo .city {
      background: linear-gradient(135deg, var(--italian-green), var(--olympic-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo .year {
      background: linear-gradient(135deg, var(--olympic-yellow), var(--italian-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-left: 0.25em;
    }

    .logo::after {
      content: '‚ùÑ';
      position: absolute;
      top: -8px;
      right: -20px;
      font-size: 0.5em;
      animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
      50% { opacity: 0.5; transform: scale(1.2) rotate(180deg); }
    }

    .section-title {
      font-size: 0.8125rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-primary);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 1em;
      background: linear-gradient(180deg, var(--italian-green), var(--italian-red));
      border-radius: 2px;
    }

    /* Tabular numbers for scores */
    .numeric, .medal-count, .points, .rank-number {
      font-feature-settings: "tnum";
      font-variant-numeric: tabular-nums;
    }

    /* Enhanced Medal gradient text */
    .medal-gold {
      background: linear-gradient(135deg, var(--gold-start), var(--gold-mid), var(--gold-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.5));
    }

    .medal-silver {
      background: linear-gradient(135deg, var(--silver-start), var(--silver-mid), var(--silver-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.3));
    }

    .medal-bronze {
      background: linear-gradient(135deg, var(--bronze-start), var(--bronze-mid), var(--bronze-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 2px rgba(205, 127, 50, 0.5));
    }

    /* ========================================
       4. LAYOUT
       ======================================== */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--space-md);
      position: relative;
      z-index: 2;
    }

    .view {
      min-height: 100vh;
      padding-bottom: 100px;
    }

    .hidden {
      display: none !important;
    }

    /* ========================================
       5. COMPONENTS - Enhanced Glass Cards
       ======================================== */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--italian-green), var(--olympic-blue), var(--italian-red));
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .glass-card:hover::before {
      opacity: 1;
    }

    .view {
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .hidden {
      display: none !important;
    }

    /* ========================================
       5. COMPONENTS - Glass Cards
       ======================================== */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
    }

    /* ========================================
       6. COMPONENTS - Buttons
       ======================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      font-family: inherit;
      font-size: 0.9375rem;
      font-weight: 600;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-normal);
      min-height: 48px;
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn:disabled::before {
      display: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--olympic-blue));
      color: #000;
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
    }

    .btn-secondary {
      background: var(--bg-surface);
      color: var(--text-primary);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-primary);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), var(--olympic-yellow));
      color: #000;
    }

    .btn-warning:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 171, 0, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), var(--italian-red));
      color: white;
    }

    .btn-danger:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 82, 82, 0.3);
    }

    .btn-large {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      font-size: 1.0625rem;
      min-height: 56px;
      border-radius: var(--radius-lg);
    }

    /* ========================================
       7. COMPONENTS - Forms
       ======================================== */
    .form-group {
      margin-bottom: var(--space-md);
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: var(--space-xs);
    }

    .form-select, .form-input {
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      font-family: inherit;
      font-size: 1rem;
      color: var(--text-primary);
      background: var(--bg-surface);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      min-height: 48px;
      transition: border-color var(--transition-fast);
    }

    .form-select:focus, .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .form-select option {
      background: var(--bg-surface);
      color: var(--text-primary);
    }

    .form-select option:disabled {
      color: var(--text-muted);
    }

    /* ========================================
       8. VIEW A - DRAFT
       ======================================== */
    .draft-header {
      text-align: center;
      padding: var(--space-2xl) 0 var(--space-xl);
    }

    .olympic-rings {
      font-size: 1.5rem;
      letter-spacing: 0.1em;
      margin-bottom: var(--space-sm);
      background: linear-gradient(90deg, #0081C8, #000000, #EE334E, #FCB131, #00A651);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .olympic-rings.small {
      font-size: 0.875rem;
      margin-bottom: 0;
    }

    .draft-header .subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-top: var(--space-sm);
    }

    .draft-header .tagline {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: var(--space-xs);
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }

    .draft-instructions {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: var(--space-lg);
      font-size: 0.9375rem;
      padding: var(--space-md);
      background: linear-gradient(135deg, rgba(0, 140, 69, 0.1), rgba(205, 33, 42, 0.1));
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .draft-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .draft-item {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .draft-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--italian-green), var(--olympic-blue), var(--italian-red));
      transform: scaleX(0);
      transition: transform var(--transition-normal);
    }

    .draft-item:hover::before {
      transform: scaleX(1);
    }

    .draft-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 212, 255, 0.15);
    }

    .draft-item-name {
      font-weight: 700;
      font-size: 1.0625rem;
      margin-bottom: var(--space-sm);
      color: var(--text-primary);
    }

    .draft-item .form-select {
      margin: 0;
    }

    #lock-draft-btn {
      margin-top: var(--space-lg);
      background: linear-gradient(135deg, var(--italian-green), var(--olympic-blue));
      font-size: 1.0625rem;
      padding: var(--space-md) var(--space-xl);
      animation: pulse-glow 2s ease-in-out infinite;
    }

    #lock-draft-btn:disabled {
      animation: none;
      background: var(--bg-surface);
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
      50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.5); }
    }

    /* ========================================
       9. VIEW B - DASHBOARD
       ======================================== */
    .dashboard-header {
      padding: var(--space-xl) 0 var(--space-lg);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--space-md);
    }

    .header-brand {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .total-medals {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 215, 0, 0.2);
      min-width: 100px;
    }

    .medal-trophy {
      font-size: 1.5rem;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .total-medals .medal-count {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-primary);
      line-height: 1;
    }

    .total-medals .medal-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Leaderboard Section */
    .leaderboard-section {
      margin-bottom: var(--space-xl);
    }

    /* Mobile: Card View */
    .leaderboard-cards {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .leaderboard-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .leaderboard-card:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .leaderboard-card.rank-1 {
      border-color: rgba(255, 215, 0, 0.4);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05), var(--glass-bg));
      animation: gold-shimmer 3s ease-in-out infinite;
    }

    @keyframes gold-shimmer {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
      50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
    }

    .leaderboard-card.rank-2 {
      border-color: rgba(192, 192, 192, 0.4);
      background: linear-gradient(135deg, rgba(192, 192, 192, 0.1), var(--glass-bg));
    }

    .leaderboard-card.rank-3 {
      border-color: rgba(205, 127, 50, 0.4);
      background: linear-gradient(135deg, rgba(205, 127, 50, 0.1), var(--glass-bg));
    }

    .rank-badge {
      width: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      background: var(--bg-surface);
      flex-shrink: 0;
      position: relative;
    }

    .rank-1 .rank-badge {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
      border: 2px solid rgba(255, 215, 0, 0.5);
    }

    .rank-2 .rank-badge {
      background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.05));
      border: 2px solid rgba(192, 192, 192, 0.4);
    }

    .rank-3 .rank-badge {
      background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.05));
      border: 2px solid rgba(205, 127, 50, 0.4);
    }

    .rank-number {
      font-size: 1.5rem;
      font-weight: 800;
    }

    .rank-1 .rank-number {
      background: linear-gradient(135deg, #FFD700, #FFEC8B, #DAA520);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .rank-2 .rank-number {
      background: linear-gradient(135deg, #E8E8E8, #FFFFFF, #A8A8A8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .rank-3 .rank-number {
      background: linear-gradient(135deg, #CD7F32, #DDA15E, #8B4513);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card-info {
      flex: 1;
      min-width: 0;
    }

    .card-team-name {
      font-weight: 600;
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-bundle-name {
      font-size: 0.8125rem;
      color: var(--text-muted);
    }

    .card-stats {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      flex-shrink: 0;
    }

    .card-medals {
      display: flex;
      gap: var(--space-xs);
      font-size: 0.8125rem;
    }

    .card-medals span {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .card-points {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent-primary);
      min-width: 40px;
      text-align: right;
    }

    /* Desktop: Table View */
    .table-wrapper {
      display: none;
      overflow-x: auto;
    }

    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9375rem;
    }

    .leaderboard-table th,
    .leaderboard-table td {
      padding: var(--space-sm) var(--space-md);
      text-align: left;
      border-bottom: var(--glass-border);
    }

    .leaderboard-table th {
      font-weight: 600;
      color: var(--text-muted);
      font-size: 0.8125rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .leaderboard-table .col-rank { width: 50px; text-align: center; }
    .leaderboard-table .col-medal { width: 50px; text-align: center; }
    .leaderboard-table .col-points { width: 70px; text-align: right; font-weight: 600; }

    .leaderboard-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .leaderboard-table .rank-cell {
      font-weight: 700;
      text-align: center;
    }

    .leaderboard-table .points-cell {
      color: var(--accent-primary);
      font-weight: 700;
      text-align: right;
    }

    .leaderboard-table tr.row-rank-1 .rank-cell { color: var(--gold-start); }
    .leaderboard-table tr.row-rank-2 .rank-cell { color: var(--silver-start); }
    .leaderboard-table tr.row-rank-3 .rank-cell { color: var(--bronze-start); }

    /* Roster Section */
    .rosters-section {
      padding-bottom: var(--space-xl);
    }

    .roster-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }

    .roster-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all var(--transition-normal);
      position: relative;
    }

    .roster-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg,
        var(--olympic-blue),
        var(--olympic-yellow),
        var(--olympic-black),
        var(--olympic-green),
        var(--olympic-red)
      );
      opacity: 0.7;
    }

    .roster-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 212, 255, 0.15);
    }

    .roster-card-header {
      padding: var(--space-md);
      border-bottom: var(--glass-border);
      background: linear-gradient(135deg, rgba(0, 129, 200, 0.1), transparent);
    }

    .roster-team-name {
      font-weight: 700;
      font-size: 1.0625rem;
      margin-bottom: 2px;
    }

    .roster-bundle-name {
      font-size: 0.75rem;
      background: linear-gradient(135deg, var(--italian-green), var(--olympic-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }

    .roster-card-body {
      padding: var(--space-md);
    }

    .roster-asset {
      padding: var(--space-sm) 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      transition: background var(--transition-fast);
    }

    .roster-asset:hover {
      background: rgba(255, 255, 255, 0.03);
      margin: 0 calc(var(--space-sm) * -1);
      padding-left: var(--space-sm);
      padding-right: var(--space-sm);
      border-radius: var(--radius-sm);
    }

    .roster-asset:last-child {
      border-bottom: none;
    }

    .asset-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-sm);
    }

    .asset-name {
      font-size: 0.9375rem;
      color: var(--text-secondary);
    }

    .asset-links {
      display: flex;
      gap: var(--space-xs);
    }

    .asset-link {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.8125rem;
      padding: var(--space-xs);
      transition: color var(--transition-fast);
      border-radius: var(--radius-sm);
    }

    .asset-link:hover {
      color: var(--accent-primary);
      background: rgba(255, 255, 255, 0.05);
    }

    .asset-medals {
      margin-top: var(--space-xs);
      padding-left: var(--space-md);
    }

    .asset-medal-item {
      font-size: 0.8125rem;
      color: var(--text-muted);
      padding: 2px 0;
    }

    .asset-medal-item .medal-emoji {
      margin-right: var(--space-xs);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      color: var(--text-muted);
      padding: var(--space-lg);
      font-style: italic;
    }

    /* Footer */
    .app-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--space-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      pointer-events: none;
    }

    .footer-info {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      font-size: 0.75rem;
      color: var(--text-muted);
      pointer-events: all;
    }

    .version {
      opacity: 0.5;
    }

    .last-updated {
      opacity: 0.7;
    }

    .admin-key-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--bg-surface);
      border: var(--glass-border);
      cursor: pointer;
      font-size: 1.125rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      pointer-events: all;
      opacity: 0.6;
    }

    .admin-key-btn:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.1);
    }

    /* ========================================
       10. VIEW C - ADMIN MODAL
       ======================================== */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    .modal-content {
      position: relative;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      background: var(--bg-surface);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) var(--space-lg);
      border-bottom: var(--glass-border);
      flex-shrink: 0;
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .close-btn {
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .modal-body {
      padding: var(--space-lg);
      overflow-y: auto;
      flex: 1;
    }

    .admin-section {
      margin-bottom: var(--space-xl);
    }

    .admin-section:last-child {
      margin-bottom: 0;
    }

    .admin-section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-md);
    }

    /* Medal Buttons */
    .medal-buttons {
      display: flex;
      gap: var(--space-sm);
    }

    .medal-btn {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      border: 2px solid transparent;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      background: var(--bg-depth);
      color: var(--text-secondary);
      min-height: 44px;
    }

    .medal-btn:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .medal-btn.selected {
      border-color: currentColor;
    }

    .medal-btn.gold.selected {
      color: var(--gold-start);
      background: rgba(255, 215, 0, 0.1);
    }

    .medal-btn.silver.selected {
      color: var(--silver-start);
      background: rgba(192, 192, 192, 0.1);
    }

    .medal-btn.bronze.selected {
      color: var(--bronze-start);
      background: rgba(205, 127, 50, 0.1);
    }

    /* Transaction Log */
    .transaction-log {
      max-height: 200px;
      overflow-y: auto;
      background: var(--bg-depth);
      border-radius: var(--radius-md);
      padding: var(--space-sm);
    }

    .transaction-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      transition: background var(--transition-fast);
    }

    .transaction-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .transaction-info {
      flex: 1;
      min-width: 0;
    }

    .transaction-main {
      font-size: 0.875rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .transaction-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .transaction-delete {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      flex-shrink: 0;
    }

    .transaction-delete:hover {
      background: rgba(255, 68, 68, 0.2);
      color: var(--danger);
    }

    /* Data Actions */
    .data-actions {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }

    .data-actions .btn {
      flex: 1;
    }

    #edit-draft-btn {
      width: 100%;
      margin-bottom: var(--space-sm);
    }

    #reset-btn {
      width: 100%;
    }

    /* ========================================
       11. TOAST NOTIFICATIONS
       ======================================== */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-surface);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-lg);
      font-size: 0.875rem;
      color: var(--text-primary);
      z-index: 1100;
      animation: toastIn 0.3s ease;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    .toast.toast-success {
      border-color: var(--success);
    }

    .toast.toast-error {
      border-color: var(--danger);
    }

    @keyframes toastIn {
      from {
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    /* ========================================
       12. RESPONSIVE - TABLET+
       ======================================== */
    @media (min-width: 768px) {
      .container {
        padding: var(--space-lg);
      }

      .logo {
        font-size: 2rem;
      }

      /* Hide mobile cards, show table */
      .leaderboard-cards {
        display: none;
      }

      .table-wrapper {
        display: block;
      }

      /* Roster grid: 2 columns */
      .roster-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      /* Modal centered */
      .modal {
        align-items: center;
      }

      .modal-content {
        border-radius: var(--radius-lg);
        max-height: 80vh;
      }
    }

    /* ========================================
       13. RESPONSIVE - DESKTOP
       ======================================== */
    @media (min-width: 1024px) {
      /* Roster grid: 3 columns */
      .roster-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .draft-list {
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      #lock-draft-btn {
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
    }
  </style>

  <!-- ============================================ -->
  <!-- JAVASCRIPT                                   -->
  <!-- ============================================ -->
  <script>
    /* ========================================
       1. CONSTANTS
       ======================================== */

    // Participants (7 couples/teams)
    const PARTICIPANTS = [
      { id: 1, name: 'Mike & Allegra Berry' },
      { id: 2, name: 'Christopher & Rebecca Wray' },
      { id: 3, name: 'Stephen & Rhandi Zipp' },
      { id: 4, name: 'Ryan & Haley Baskerville' },
      { id: 5, name: 'Preston & Maddi Amundson' },
      { id: 6, name: 'Jaynen & Britt Rissling' },
      { id: 7, name: 'Kieran & Zoe Armstrong' }
    ];

    // Bundles (7 balanced fantasy bundles based on 2026 medal projections)
    const BUNDLES = [
      {
        id: 1,
        name: 'Nordic Lightning',
        assets: ['norway-xc', 'sweden-general']
      },
      {
        id: 2,
        name: 'Precision & Power',
        assets: ['germany-general', 'norway-biathlon']
      },
      {
        id: 3,
        name: 'American Dream',
        assets: ['jordan-stolz', 'chloe-kim', 'usa-general']
      },
      {
        id: 4,
        name: 'Alpine Royalty',
        assets: ['switzerland-general', 'austria-general', 'mikaela-shiffrin']
      },
      {
        id: 5,
        name: 'Speed Dynasty',
        assets: ['netherlands-skating', 'italy-general', 'france-general']
      },
      {
        id: 6,
        name: 'Eastern Promise',
        assets: ['eileen-gu', 'japan-general', 'china-general']
      },
      {
        id: 7,
        name: 'Ice Warriors',
        assets: ['canada-general', 'finland-general', 'ilia-malinin']
      }
    ];

    // Assets (18 trackable entities with Olympics.com links)
    const ASSETS = {
      // Bundle 1: Nordic Lightning
      'norway-xc': {
        name: 'Norway (Cross-Country Skiing)',
        bundleId: 1,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/nor',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ccs'
      },
      'sweden-general': {
        name: 'Sweden (General)',
        bundleId: 1,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/swe',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule'
      },
      // Bundle 2: Precision & Power
      'germany-general': {
        name: 'Germany (Sliding/Biathlon)',
        bundleId: 2,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ger',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/bth'
      },
      'norway-biathlon': {
        name: 'Norway (Biathlon)',
        bundleId: 2,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/nor',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/bth'
      },
      // Bundle 3: American Dream
      'jordan-stolz': {
        name: 'Jordan Stolz (USA)',
        bundleId: 3,
        olympicsUrl: 'https://olympics.com/en/athletes/jordan-stolz',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ssk'
      },
      'chloe-kim': {
        name: 'Chloe Kim (USA)',
        bundleId: 3,
        olympicsUrl: 'https://olympics.com/en/athletes/chloe-kim',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/snb'
      },
      'usa-general': {
        name: 'Team USA (General)',
        bundleId: 3,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/usa',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule'
      },
      // Bundle 4: Alpine Royalty
      'switzerland-general': {
        name: 'Switzerland (General)',
        bundleId: 4,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/sui',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ask'
      },
      'austria-general': {
        name: 'Austria (General)',
        bundleId: 4,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/aut',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ask'
      },
      'mikaela-shiffrin': {
        name: 'Mikaela Shiffrin (USA)',
        bundleId: 4,
        olympicsUrl: 'https://olympics.com/en/athletes/mikaela-shiffrin',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ask'
      },
      // Bundle 5: Speed Dynasty
      'netherlands-skating': {
        name: 'Netherlands (Speed Skating)',
        bundleId: 5,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ned',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ssk'
      },
      'italy-general': {
        name: 'Italy (Host Nation)',
        bundleId: 5,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/ita',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule'
      },
      'france-general': {
        name: 'France (General)',
        bundleId: 5,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/fra',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/bth'
      },
      // Bundle 6: Eastern Promise
      'eileen-gu': {
        name: 'Eileen Gu (China)',
        bundleId: 6,
        olympicsUrl: 'https://olympics.com/en/athletes/eileen-gu',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/frs'
      },
      'japan-general': {
        name: 'Japan (General)',
        bundleId: 6,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/jpn',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/fsk'
      },
      'china-general': {
        name: 'China (General)',
        bundleId: 6,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/chn',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/sts'
      },
      // Bundle 7: Ice Warriors
      'canada-general': {
        name: 'Canada (Hockey + General)',
        bundleId: 7,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/can',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ihk'
      },
      'finland-general': {
        name: 'Finland (General)',
        bundleId: 7,
        olympicsUrl: 'https://olympics.com/en/olympic-games/milan-cortina-2026/countries/fin',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/ihk'
      },
      'ilia-malinin': {
        name: 'Ilia Malinin (USA)',
        bundleId: 7,
        olympicsUrl: 'https://olympics.com/en/athletes/ilia-malinin',
        scheduleUrl: 'https://olympics.com/en/milano-cortina-2026/schedule/fsk'
      }
    };

    // Scoring
    const MEDAL_POINTS = { gold: 3, silver: 2, bronze: 1 };
    const MEDAL_EMOJI = { gold: 'ü•á', silver: 'ü•à', bronze: 'ü•â' };

    // Storage key
    const STORAGE_KEY = 'milan2026_state';

    // Admin passcode
    const ADMIN_PASSCODE = 'gold';

    /* ========================================
       2. STATE MANAGEMENT
       ======================================== */

    let appState = {
      config: {},      // participantId -> bundleId
      medalsLog: []    // array of medal entries
    };

    // Admin UI state (not persisted)
    let selectedMedalType = null;

    function loadState() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          appState = JSON.parse(saved);
          // Ensure arrays exist
          if (!appState.medalsLog) appState.medalsLog = [];
          if (!appState.config) appState.config = {};
        }
      } catch (e) {
        console.error('Failed to load state:', e);
        appState = { config: {}, medalsLog: [] };
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
      } catch (e) {
        console.error('Failed to save state:', e);
      }
    }

    function updateState(newState) {
      appState = { ...appState, ...newState };
      saveState();
      render();
    }

    /* ========================================
       3. UTILITY FUNCTIONS
       ======================================== */

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
    }

    function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      });
    }

    function getOlympicsUrl(assetId) {
      const asset = ASSETS[assetId];
      return asset ? asset.olympicsUrl : '#';
    }

    function getScheduleUrl(assetId) {
      const asset = ASSETS[assetId];
      return asset ? asset.scheduleUrl : '#';
    }

    function getBundleById(bundleId) {
      return BUNDLES.find(b => b.id === bundleId);
    }

    function getParticipantById(participantId) {
      return PARTICIPANTS.find(p => p.id === participantId);
    }

    function getParticipantByBundleId(bundleId) {
      for (const [pId, bId] of Object.entries(appState.config)) {
        if (bId === bundleId) {
          return getParticipantById(parseInt(pId));
        }
      }
      return null;
    }

    function isDraftComplete() {
      return Object.keys(appState.config).length === PARTICIPANTS.length;
    }

    /* ========================================
       4. SCORING CALCULATIONS
       ======================================== */

    function calculateScores() {
      // Initialize scores for each participant
      const scores = {};
      PARTICIPANTS.forEach(p => {
        scores[p.id] = { gold: 0, silver: 0, bronze: 0, total: 0 };
      });

      // Process medals log
      appState.medalsLog.forEach(entry => {
        const asset = ASSETS[entry.entityId];
        if (!asset) return;

        const bundleId = asset.bundleId;
        const participant = getParticipantByBundleId(bundleId);
        if (!participant) return;

        scores[participant.id][entry.medal]++;
        scores[participant.id].total += MEDAL_POINTS[entry.medal];
      });

      return scores;
    }

    function getLeaderboard() {
      const scores = calculateScores();

      const leaderboard = PARTICIPANTS.map(p => {
        const bundleId = appState.config[p.id];
        const bundle = getBundleById(bundleId);
        return {
          participant: p,
          bundle: bundle,
          scores: scores[p.id]
        };
      });

      // Sort by total points DESC, then gold count DESC
      leaderboard.sort((a, b) => {
        if (b.scores.total !== a.scores.total) {
          return b.scores.total - a.scores.total;
        }
        return b.scores.gold - a.scores.gold;
      });

      return leaderboard;
    }

    function getTotalMedals() {
      return appState.medalsLog.length;
    }

    function getMedalsForAsset(entityId) {
      return appState.medalsLog.filter(m => m.entityId === entityId);
    }

    /* ========================================
       5. RENDER FUNCTIONS
       ======================================== */

    function render() {
      if (!isDraftComplete()) {
        showDraftView();
      } else {
        showDashboardView();
      }
    }

    function showDraftView() {
      document.getElementById('draft-view').classList.remove('hidden');
      document.getElementById('dashboard-view').classList.add('hidden');
      renderDraftList();
    }

    function showDashboardView() {
      document.getElementById('draft-view').classList.add('hidden');
      document.getElementById('dashboard-view').classList.remove('hidden');
      renderDashboard();
    }

    function renderDraftList() {
      const container = document.getElementById('draft-list');
      const selectedBundles = new Set(Object.values(appState.config));

      container.innerHTML = PARTICIPANTS.map(p => {
        const currentSelection = appState.config[p.id] || '';

        const options = BUNDLES.map(b => {
          const isSelected = currentSelection === b.id;
          const isDisabled = !isSelected && selectedBundles.has(b.id);
          return `<option value="${b.id}" ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}>
            ${b.name}
          </option>`;
        }).join('');

        return `
          <div class="draft-item">
            <div class="draft-item-name">${p.name}</div>
            <select class="form-select draft-select" data-participant-id="${p.id}">
              <option value="">-- Select bundle --</option>
              ${options}
            </select>
          </div>
        `;
      }).join('');

      // Add event listeners
      container.querySelectorAll('.draft-select').forEach(select => {
        select.addEventListener('change', handleDraftSelection);
      });

      updateLockButton();
    }

    function handleDraftSelection(e) {
      const participantId = parseInt(e.target.dataset.participantId);
      const bundleId = e.target.value ? parseInt(e.target.value) : null;

      if (bundleId) {
        appState.config[participantId] = bundleId;
      } else {
        delete appState.config[participantId];
      }

      saveState();
      renderDraftList();
    }

    function updateLockButton() {
      const btn = document.getElementById('lock-draft-btn');
      const allSelected = Object.keys(appState.config).length === PARTICIPANTS.length;
      btn.disabled = !allSelected;
    }

    function renderDashboard() {
      renderTotalMedals();
      renderLastUpdated();
      renderLeaderboard();
      renderRosterGrid();
    }

    function renderTotalMedals() {
      document.getElementById('total-medal-count').textContent = getTotalMedals();
    }

    function renderLastUpdated() {
      const el = document.getElementById('last-updated');
      if (appState.medalsLog.length === 0) {
        el.textContent = '';
        return;
      }
      const lastMedal = appState.medalsLog[appState.medalsLog.length - 1];
      el.textContent = `Updated ${formatTimestamp(lastMedal.timestamp)}`;
    }

    function renderLeaderboard() {
      const leaderboard = getLeaderboard();

      // Mobile cards
      const cardsContainer = document.getElementById('leaderboard-cards');
      cardsContainer.innerHTML = leaderboard.map((entry, index) => {
        const rank = index + 1;
        const { participant, bundle, scores } = entry;
        const bundleName = bundle ? bundle.name : 'Not drafted';

        return `
          <div class="leaderboard-card rank-${rank <= 3 ? rank : 'other'}">
            <div class="rank-badge">
              <span class="rank-number">${rank}</span>
            </div>
            <div class="card-info">
              <div class="card-team-name">${participant.name}</div>
              <div class="card-bundle-name">${bundleName}</div>
            </div>
            <div class="card-stats">
              <div class="card-medals">
                <span class="medal-gold">${scores.gold}</span>
                <span class="medal-silver">${scores.silver}</span>
                <span class="medal-bronze">${scores.bronze}</span>
              </div>
              <div class="card-points numeric">${scores.total}</div>
            </div>
          </div>
        `;
      }).join('');

      // Desktop table
      const tbody = document.getElementById('leaderboard-tbody');
      tbody.innerHTML = leaderboard.map((entry, index) => {
        const rank = index + 1;
        const { participant, bundle, scores } = entry;
        const bundleName = bundle ? bundle.name : 'Not drafted';

        return `
          <tr class="row-rank-${rank <= 3 ? rank : 'other'}">
            <td class="rank-cell numeric">${rank}</td>
            <td>${participant.name}</td>
            <td>${bundleName}</td>
            <td class="numeric" style="text-align:center"><span class="medal-gold">${scores.gold}</span></td>
            <td class="numeric" style="text-align:center"><span class="medal-silver">${scores.silver}</span></td>
            <td class="numeric" style="text-align:center"><span class="medal-bronze">${scores.bronze}</span></td>
            <td class="points-cell numeric">${scores.total}</td>
          </tr>
        `;
      }).join('');
    }

    function renderRosterGrid() {
      const container = document.getElementById('roster-grid');

      container.innerHTML = PARTICIPANTS.map(p => {
        const bundleId = appState.config[p.id];
        const bundle = getBundleById(bundleId);

        if (!bundle) {
          return `
            <div class="roster-card">
              <div class="roster-card-header">
                <div class="roster-team-name">${p.name}</div>
                <div class="roster-bundle-name">Not drafted</div>
              </div>
              <div class="roster-card-body">
                <p class="empty-state">No bundle assigned</p>
              </div>
            </div>
          `;
        }

        const assetsHtml = bundle.assets.map(assetId => {
          const asset = ASSETS[assetId];
          const medals = getMedalsForAsset(assetId);
          const olympicsUrl = getOlympicsUrl(assetId);
          const scheduleUrl = getScheduleUrl(assetId);

          const medalsHtml = medals.length > 0 ? `
            <div class="asset-medals">
              ${medals.map(m => `
                <div class="asset-medal-item">
                  <span class="medal-emoji">${MEDAL_EMOJI[m.medal]}</span>
                  <span>${m.eventDescription}</span>
                </div>
              `).join('')}
            </div>
          ` : '';

          return `
            <div class="roster-asset">
              <div class="asset-header">
                <span class="asset-name">${asset.name}</span>
                <div class="asset-links">
                  <a href="${olympicsUrl}" target="_blank" rel="noopener noreferrer" class="asset-link" title="Olympics.com Profile">üîó</a>
                  <a href="${scheduleUrl}" target="_blank" rel="noopener noreferrer" class="asset-link" title="Event Schedule">üìÖ</a>
                </div>
              </div>
              ${medalsHtml}
            </div>
          `;
        }).join('');

        return `
          <div class="roster-card">
            <div class="roster-card-header">
              <div class="roster-team-name">${p.name}</div>
              <div class="roster-bundle-name">${bundle.name}</div>
            </div>
            <div class="roster-card-body">
              ${assetsHtml}
            </div>
          </div>
        `;
      }).join('');
    }

    /* ========================================
       6. ADMIN CONSOLE
       ======================================== */

    function openAdminModal() {
      const passcode = prompt('Enter admin passcode:');
      if (passcode !== ADMIN_PASSCODE) {
        if (passcode !== null) {
          showToast('Access denied', 'error');
        }
        return;
      }

      document.getElementById('admin-modal').classList.remove('hidden');
      renderAdminPanel();
    }

    function closeAdminModal() {
      document.getElementById('admin-modal').classList.add('hidden');
      resetAdminForm();
    }

    function renderAdminPanel() {
      renderEntitySelect();
      renderTransactionLog();
      resetAdminForm();
    }

    function renderEntitySelect() {
      const select = document.getElementById('entity-select');

      // Sort assets alphabetically
      const sortedAssets = Object.entries(ASSETS)
        .sort((a, b) => a[1].name.localeCompare(b[1].name));

      select.innerHTML = `
        <option value="">-- Select athlete/team --</option>
        ${sortedAssets.map(([id, asset]) => `
          <option value="${id}">${asset.name}</option>
        `).join('')}
      `;
    }

    function renderTransactionLog() {
      const container = document.getElementById('transaction-log');

      if (appState.medalsLog.length === 0) {
        container.innerHTML = '<p class="empty-state">No medals recorded yet</p>';
        return;
      }

      // Show last 10, most recent first
      const recentMedals = [...appState.medalsLog].reverse().slice(0, 10);

      container.innerHTML = recentMedals.map(entry => {
        const asset = ASSETS[entry.entityId];
        const assetName = asset ? asset.name : 'Unknown';

        return `
          <div class="transaction-item">
            <div class="transaction-info">
              <div class="transaction-main">
                ${MEDAL_EMOJI[entry.medal]} ${assetName} - ${entry.eventDescription}
              </div>
              <div class="transaction-time">${formatTimestamp(entry.timestamp)}</div>
            </div>
            <button class="transaction-delete" data-medal-id="${entry.id}" title="Remove medal">&times;</button>
          </div>
        `;
      }).join('');

      // Add delete listeners
      container.querySelectorAll('.transaction-delete').forEach(btn => {
        btn.addEventListener('click', () => {
          const medalId = btn.dataset.medalId;
          removeMedal(medalId);
        });
      });
    }

    function resetAdminForm() {
      document.getElementById('entity-select').value = '';
      document.getElementById('event-input').value = '';
      selectedMedalType = null;

      document.querySelectorAll('.medal-btn').forEach(btn => {
        btn.classList.remove('selected');
      });

      updateAddMedalButton();
    }

    function updateAddMedalButton() {
      const entityId = document.getElementById('entity-select').value;
      const eventDesc = document.getElementById('event-input').value.trim();
      const btn = document.getElementById('add-medal-btn');

      btn.disabled = !entityId || !eventDesc || !selectedMedalType;
    }

    function addMedal() {
      const entityId = document.getElementById('entity-select').value;
      const eventDesc = document.getElementById('event-input').value.trim();

      if (!entityId || !eventDesc || !selectedMedalType) return;

      const asset = ASSETS[entityId];

      // Confirmation
      const confirmMsg = `Add ${selectedMedalType.toUpperCase()} medal to ${asset.name} for "${eventDesc}"?`;
      if (!confirm(confirmMsg)) return;

      const newMedal = {
        id: generateId(),
        entityId: entityId,
        eventDescription: eventDesc,
        medal: selectedMedalType,
        timestamp: Date.now()
      };

      appState.medalsLog.push(newMedal);
      saveState();

      showToast(`${MEDAL_EMOJI[selectedMedalType]} Medal added!`, 'success');
      resetAdminForm();
      renderTransactionLog();
      renderDashboard();
    }

    function removeMedal(medalId) {
      if (!confirm('Remove this medal?')) return;

      appState.medalsLog = appState.medalsLog.filter(m => m.id !== medalId);
      saveState();

      showToast('Medal removed', 'success');
      renderTransactionLog();
      renderDashboard();
    }

    function exportData() {
      const json = JSON.stringify(appState, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        showToast('Data copied to clipboard!', 'success');
      }).catch(() => {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = json;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('Data copied to clipboard!', 'success');
      });
    }

    function importData() {
      const json = prompt('Paste JSON data:');
      if (!json) return;

      try {
        const data = JSON.parse(json);
        if (!data.config || !data.medalsLog) {
          throw new Error('Invalid data structure');
        }
        appState = data;
        saveState();
        showToast('Data imported successfully!', 'success');
        closeAdminModal();
        render();
      } catch (e) {
        showToast('Invalid JSON data', 'error');
      }
    }

    function editDraft() {
      if (!confirm('This will allow you to change the draft. Continue?')) return;
      closeAdminModal();
      showDraftView();
    }

    function resetLeague() {
      if (!confirm('‚ö†Ô∏è This will DELETE ALL DATA including draft and medals. Are you sure?')) return;
      if (!confirm('This cannot be undone. Type "RESET" to confirm.') || prompt('Type RESET to confirm:') !== 'RESET') {
        showToast('Reset cancelled', 'error');
        return;
      }

      localStorage.removeItem(STORAGE_KEY);
      appState = { config: {}, medalsLog: [] };
      showToast('League reset', 'success');
      closeAdminModal();
      render();
    }

    /* ========================================
       7. TOAST NOTIFICATIONS
       ======================================== */

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast toast-${type}`;
      toast.classList.remove('hidden');

      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    /* ========================================
       8. EVENT LISTENERS
       ======================================== */

    function initEventListeners() {
      // Lock Draft button
      document.getElementById('lock-draft-btn').addEventListener('click', () => {
        if (!confirm('Lock the draft? You can edit it later in the admin console.')) return;
        showToast('Draft locked!', 'success');
        render();
      });

      // Admin key button
      document.getElementById('admin-key-btn').addEventListener('click', openAdminModal);

      // Close modal
      document.getElementById('close-modal-btn').addEventListener('click', closeAdminModal);
      document.getElementById('modal-backdrop').addEventListener('click', closeAdminModal);

      // Medal type buttons
      document.querySelectorAll('.medal-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.medal-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedMedalType = btn.dataset.medal;
          updateAddMedalButton();
        });
      });

      // Add Medal form
      document.getElementById('entity-select').addEventListener('change', updateAddMedalButton);
      document.getElementById('event-input').addEventListener('input', updateAddMedalButton);
      document.getElementById('add-medal-btn').addEventListener('click', addMedal);

      // Data management buttons
      document.getElementById('export-btn').addEventListener('click', exportData);
      document.getElementById('import-btn').addEventListener('click', importData);
      document.getElementById('edit-draft-btn').addEventListener('click', editDraft);
      document.getElementById('reset-btn').addEventListener('click', resetLeague);

      // Keyboard: Escape to close modal
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeAdminModal();
        }
      });
    }

    /* ========================================
       9. SNOWFALL ANIMATION
       ======================================== */

    function createSnowfall() {
      const container = document.getElementById('snowfall');
      const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úß', '‚ú¶'];
      const numFlakes = 30;

      for (let i = 0; i < numFlakes; i++) {
        const flake = document.createElement('span');
        flake.className = 'snowflake';
        flake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
        flake.style.left = Math.random() * 100 + '%';
        flake.style.animationDuration = (Math.random() * 10 + 10) + 's';
        flake.style.animationDelay = Math.random() * 10 + 's';
        flake.style.fontSize = (Math.random() * 0.8 + 0.5) + 'rem';
        flake.style.opacity = Math.random() * 0.6 + 0.2;
        container.appendChild(flake);
      }
    }

    /* ========================================
       10. INITIALIZATION
       ======================================== */

    function init() {
      createSnowfall();
      loadState();
      initEventListeners();
      render();
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', init);
  </script>

</body>
</html>
